{% load static %}

<link href="{% static 'libs/bower_components/animate.css/animate.min.css' %}" rel="stylesheet">
<script src="{% static 'libs/bower_components/animatedmodal/animatedModal.js' %}"></script>

<a id="acceptTOSBtn" href="#animatedModal"></a>
<!--acceptTOSBtn-->
<div id="animatedModal">
    <!--THIS IS IMPORTANT! to close the modal, the class name has to match the name given on the ID  class="close-animatedModal" -->


    <div class="modal-content text-center col-sm-12 col-md-8 col-md-offset-2">
        <img src="https://cdn.dropified.com/static/dropified-logo.png" style="margin-top:50px;width:300px">

        <div class="text-left">
            <h1 class="col-md-offset-1" style="margin-top:50px">Welcome to Dropified!</h1>

            <h1 class="col-md-offset-1" style="margin-top:20px">
                Before you continue, please read and agree to the
                <a href="https://app.dropified.com/terms-of-service" style="font-weight:initial;" target="_blank">Terms &amp; Conditions</a>
            </h1>

            <h2 class="col-md-offset-1" style="margin-top:20px">
                Your personal information is used in accordance with the GDPR. For more information,
                <a href="https://www.dropified.com/gdpr-compliance/" style="font-weight:initial;" target="_blank">click here.</a>
            </h2>

            <div id="must-accept" class="row">
                <div class="col-md-offset-1 col-md-11">
                    <label forHtml="accept-tos">
                        <input name="accept-tos" type="checkbox" class="icheck">
                        I have read these Terms & Conditions and I understand where I can find these Terms & Conditions to read them again.
                    </label>
                </div>

                <div class="col-md-offset-1 col-md-11">
                    <label forHtml="over-16">
                        <input name="over-16" type="checkbox" class="icheck">
                        I confirm that I am 16 years of age.
                    </label>
                </div>

                <div class="col-md-offset-1 col-md-11">
                    <label forHtml="knows-personal-info-mean">
                        <input name="knows-personal-info-mean" type="checkbox" class="icheck">
                        I understand what "Personal Info" means.
                    </label>
                </div>

                <div class="col-md-offset-1 col-md-11">
                    <label forHtml="permits-personal-data">
                        <input name="permits-personal-data" type="checkbox" class="icheck">
                        I understand that Dropified requires my name, email address, mailing address, billing information and other personal information in order to bill me.
                    </label>
                </div>

                <div class="col-md-offset-1 col-md-11">
                    <label forHtml="understand-rights">
                        <input name="understand-rights" type="checkbox" class="icheck">
                        I understand how I can:
                        <ul style="list-style-type: lower-alpha;">
                            <li>Make changes in specified personal data</li>
                            <li>Complete request to view my personal data</li>
                            <li>Request to restrict processing of my personal data</li>
                            <li>Request to delete my personal data</li>
                            <li>Report a violation of GDPR principles</li>
                        </ul>
                    </label>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <a class="btn btn-success btn-lg close-animatedModal" style="margin: 40px 0;" data-loading-text="Continue" >
                    Continue
                </a>
            </div>
        </div>
    </div>
</div>

<style type="text/css">
    #animatedModal {
        display: flex !important;
        align-items: center !important;
    }
</style>

<script type="text/javascript">
    $(function () {

        $("#acceptTOSBtn").animatedModal({
            beforeOpen: function () {
                $('#animatedModal .icheckbox_square-blue').css('position', 'initial');
                if($.fn.hasOwnProperty('bootstrapBtn')) {
                    $('#animatedModal .close-animatedModal').bootstrapBtn('loading');
                } else {
                    $('#animatedModal .close-animatedModal').button('loading');
                }

                $('#animatedModal').css('background-color', 'rgba(147, 196, 125, 0.9)');
            },
            afterOpen: function () {
                $('#animatedModal').css('background-color', 'rgba(147, 196, 125, 0.9)');
            }
        });

        $("#acceptTOSBtn").trigger('click');

        function canContinue() {
            var acceptTos = $('[name="accept-tos"]').is(':checked'),
                overAge = $('[name="over-16"]').is(':checked'),
                knowsPersonalInfoMean = $('[name="knows-personal-info-mean"]').is(':checked'),
                permitsPersonalData = $('[name="permits-personal-data"]').is(':checked'),
                understandRights = $('[name="understand-rights"]').is(':checked');

            return acceptTos && overAge && knowsPersonalInfoMean && permitsPersonalData && understandRights;
        }

        $('#must-accept input[type="checkbox"]').on('ifToggled', function(e){
            if($.fn.hasOwnProperty('bootstrapBtn')) {
                $('#animatedModal .close-animatedModal').bootstrapBtn(canContinue() ? 'reset' : 'loading');
            } else {
                $('#animatedModal .close-animatedModal').button(canContinue() ? 'reset' : 'loading');
            }
        });

        $('#animatedModal .close-animatedModal').click(function (e) {
            $.ajax({
                url: '/api/user-config',
                type: 'POST',
                data: {
                    'single': true,
                    'name': '_tos-accept',
                    'value': Math.floor(Date.now() / 1000),
                },
                success: function (data) {
                    $('.tos-update').remove();
                },
                error: function (data) {
                    displayAjaxError('Accept TOS', data);
                }
            });
        });
    });

</script>
