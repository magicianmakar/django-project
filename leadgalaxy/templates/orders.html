{% extends "base.html" %}

{% load static %}

{% block main-container %}

    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>Shopify Stores<small></small></h5>
            <div class="ibox-tools">
                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
            </div>
        </div>
        <div class="ibox-content">
            <div class="row">
                <div class="col-md-12">
            <table class="table table-condensed table-hover">
              <thead>
                <tr>
                  <th>Order #</th>
                  <th>Date</th>
                  <th>Customer</th>
                  <th>Payment Status</th>
                  <th>Fulfillment Status</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>
                            <a href="#" class="more-info"><i class="fa fa-plus" style="margin-right:10px"></i></a>
                            <a href="{{order.order_url}}" target="_blank">{{order.name}}</a>
                        </td>
                        <td>{{order.date_str}}</a></td>
                        <td>{{order.customer.first_name}} {{order.customer.last_name}}</td>
                        <td>{{order.financial_status|title}}</td>
                        <td>
                            {% if not order.fulfillment_status %}
                                <span class="label label-warning">Unfulfilled</span>
                            {% else %}
                                <span class="label label-success">{{order.fulfillment_status|title}}</span>
                            {% endif %}
                        </td>
                        <td>
                            <b>{% if order.currency == 'USD' %} ${% else %} {{order.currency}} {% endif %}{{order.total_price}}</b>
                        </td>
                    </tr>

                    <tr class="var-info" style="display:none">
                        <td colspan="6">
                            <table class="table table-condensed xtable-hover xtable-bordered">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th style="width:310px"></th>
                                        <th>Variant</th>
                                        <th>Qty</th>
                                        <th>Vendor</th>
                                        <th></th>
                                        <th></th>
                                        <th>Shipping Address</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in order.line_items %}
                                    {% with image=item.image original=item.product.get_original_info %}
                                    <tr>
                                        <td>
                                            <img
                                            {% if image %}
                                            src="{{image}}"
                                            {% else %}
                                            src="{{item.product.get_images|first}}"
                                            {% endif %}
                                            style="width:64px" />
                                        </td>
                                        <td>{{item.name}}</td>
                                        <td><a href="{{item.variant_link}}" target="_blank">{{item.variant_title}}</a></td>
                                        <td>
                                            <span style="{% if item.quantity > 1 %} font-weight: bolder; color: blue{% endif %}">{{item.quantity}}</span>
                                        </td>
                                        <td>{{item.vendor}}</td>
                                        <td>
                                            {% if original %}
                                            <a href="{{original.url}}" target="_blank" class="btn btn-success btn-xs itooltip"  data-toggle="tooltip" data-placement="top" title="Sourced from: {{original.source}}">Place Order</a>
                                            {% else %}
                                            <span class="label label-warning">Non tracked</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                        {% if not item.fulfillment_status %}
                                            <span class="label label-warning">Unfulfilled</span>
                                        {% else %}
                                            <span class="label label-success">{{item.fulfillment_status|title}}</span>
                                        {% endif %}
                                        </td>
                                        {% if forloop.counter0 == 0 %}
                                        <td rowspan="{{order.line_items|length}}">
                                            {{order.shipping_address.address1}}<br>
                                            {{order.shipping_address.address2}}{% if order.shipping_address.address2 %}<br>{% endif %}
                                            {{order.shipping_address.city}}, {{order.shipping_address.province_code}} {{order.shipping_address.zip}}
                                            {% if order.shipping_address.country_code != 'US' %}
                                            <br> <b>{{order.shipping_address.country}}</b>
                                            {% endif %}
                                            <br>
                                        </td>
                                        {% endif %}
                                    </tr>
                                    {% endwith %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </td>
                    </tr>


                    {% empty %}
                    <tr>
                      <td colspan="3" class="text-center">No store found.</td>
                    </tr>
                    {% endfor %}
              </tbody>
            </table>

            <a data-toggle="modal" class="btn btn-primary" href="#modal-form">Add Store</a>
                </div>
            </div>

        </div>
    </div>
{% endblock %}


{% block extrajs %}
<script type="text/javascript">
    $(function () {
        $(".itooltip").tooltip();
    });

    $(".more-info").click(function (e) {
        e.preventDefault();

        var element = $(this).find('i');
        var target = $(this).parents('tr').next();
        target.toggle('fade', function() {
            if (target.is(":visible")) {
                element.removeClass('fa-plus');
                element.addClass('fa-minus');
            } else {
                element.removeClass('fa-minus');
                element.addClass('fa-plus');
            }
        });
    });
</script>
{% endblock %}

