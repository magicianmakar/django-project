{% extends "base.html" %}

{% load staticfiles %}
{% load perms_helper %}
{% load compress %}
{% load template_helper %}
{% load url_tools %}

{% block main-container %}

{% include 'profit_dashboard/partial/facebook.html' %}

<div class="tabs-container">
  <ul class="nav nav-tabs">
    {% for item in user.profile.get_shopify_stores %}
      {% if store == item or item.id|stringformat:"i" == request.GET.store %}
        <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true">{{item.title}}</a></li>
      {% else %}
        <li class=""><a href="{% url 'profit_dashboard.views.index' %}?store={{item.id}}" aria-expanded="false">{{item.title}}</a></li>
      {% endif %}
    {% endfor %}
  </ul>

  <div class="tab-content">
    <div id="tab-1" class="tab-pane active">
      <div class="panel-body">
        <form class="form-inline" method="get">
          <input type="hidden" name="store" value="{{ store.id }}">
          <input type="hidden" class="form-control" name="start" value="{{ start }}"/>
          <input type="hidden" class="form-control" name="end" value="{{ end }}" />
          <!-- <div class="form-group" id="profit-range">
            <label>Range date</label>
            <div class="input-daterange input-group" id="datepicker" style="width: auto;">
              <input type="text" class="form-control" name="start" value="{{ start }}"/>
              <span class="input-group-addon">to</span>
              <input type="text" class="form-control" name="end" value="{{ end }}" />
            </div>
          </div>
          <button type="submit" class="btn btn-success">Filter</button> -->

          <!-- <ul id="pagination-limit" class="top-controls pull-right">
            <li>
              <label>Items per page:</label>
            </li>
            <li{% if limit == 10 %} class="active"{% endif %}>
              <a href="?store={{ store.pk }}&start={{ start }}&end={{ end }}&limit=10">10</a>
            </li>
            <li{% if limit == 50 %} class="active"{% endif %}>
              <a href="?store={{ store.pk }}&start={{ start }}&end={{ end }}&limit=50">50</a>
            </li>
            <li{% if limit == 100 %} class="active"{% endif %}>
              <a href="?store={{ store.pk }}&start={{ start }}&end={{ end }}&limit=100">100</a>
            </li>
            <li{% if limit == 0 %} class="active"{% endif %}>
              <a href="?store={{ store.pk }}&start={{ start }}&end={{ end }}&limit=0">All</a>
            </li>
            <li>
              <input type="text" name="limit" placeholder="Type here" value="{{ limit|default:"" }}" />
            </li>
          </ul> -->

          <ul id="table-view" class="top-controls pull-right">
            <li><label>View:</label></li>
            <li><a href="javascript:;" class="btn active btn-success daily" data-time="daily">Daily</a></li>
            <li><a href="javascript:;" class="btn btn-default weekly" data-time="weekly">Weekly</a></li>
          </ul>

          <ul id="graph-view" class="top-controls pull-right hidden">
            <li><label>View:</label></li>
            <li><a href="#" class="btn btn-default daily" data-time="daily">Daily</a></li>
            <li><a href="#" class="btn btn-default weekly" data-time="weekly">Weekly</a></li>
            <!-- <li><a href="#" class="btn btn-default monthly" data-time="monthly">Monthly</a></li> -->
          </ul>
        </form>

        <div id="top-controls-menu">
          <ul class="nav nav-tabs clients-list">
              <li class="active"><a data-toggle="tab" href="#tab-data-table" data-top-controls="#pagination-limit, #table-view"><i class="fa fa-table"></i> Table</a></li>
              <li class=""><a data-toggle="tab" href="#tab-charts" data-top-controls="#graph-view"><i class="fa fa-line-chart"></i> Charts</a></li>
              <li class=""><a data-toggle="tab" href="#tab-details" data-top-controls="#details-view"><i class="fa fa-line-chart"></i> Details</a></li>
          </ul>
          <div class="tab-content">
              <div id="tab-data-table" class="tab-pane active clients-list">
                {% include 'profit_dashboard/partial/totals.html' %}
                <br>
                {% include 'profit_dashboard/partial/table.html' %}
              </div>
              <div id="tab-charts" class="tab-pane">
                <br>
                {% include 'profit_dashboard/partial/chart.html' %}
              </div>
              <div id="tab-details" class="tab-pane">
                <br>
                {% include 'profit_dashboard/partial/details.html' %}
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extracss %}
{% compress css %}
  <link href="{% static 'libs/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css' %}" rel="stylesheet">
  <link href="{% static 'profit/index.css' %}" rel="stylesheet">
{% endcompress %}
{% endblock %}

{% block extrajs %}
  <script type="text/javascript">
    var config = {
      facebook: {
        {% if user|can:'profit_dashboard_facebook.use' %}
        appId: "{% app_setting 'FACEBOOK_APP_ID' %}"
        {% else %}
        appId: null
        {% endif %}
      },
      sub_conf: {
        key: "{% app_setting 'PUSHER_KEY' %}",
        channel: "{{ store.pusher_channel }}",
      },
      profitOtherCostsAjaxUrl: "{% url 'profit_dashboard.views.save_other_costs' %}?store={{ store.id }}",
      currencySign: "{% money_format None store %}",
      currencyFormat: "{{ store.currency_format|default:'' }}"
    };

    var profitsData = {{ profits_json|safe }};
  </script>

  <script src="//js.pusher.com/3.2/pusher.min.js"></script>
  <script src="//connect.facebook.net/en_US/sdk.js" id="facebook-jssdk"></script>

{% compress js %}
  <script src="{% static 'libs/bower_components/moment/min/moment.min.js' %}"></script>
  <script src="{% static 'libs/bower_components/chart.js/dist/Chart.bundle.js' %}"></script>
  <script src="{% static 'libs/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js' %}"></script>
  <script src="{% static 'libs/bower_components/handlebars/handlebars.min.js' %}"></script>
  <script src="{% static 'profit/index.js' %}"></script>
{% endcompress %}

{% endblock %}
