{% extends "supplements/tab_view_admin.html" %}
{% load static %}
{% load widget_tweaks %}
{% load perms_helper %}

{% block extra_pls_css %}
<link href="{% static 'libs/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css' %}" rel="stylesheet">
{% endblock %}

{% block tab_content %}

<div>
  {% include "supplements/partials/filter_form.html" %}
</div>

{% if request.user|can:'pls_admin.use' %}
<hr />

<h2>Add New Payout</h2>
<form method="POST" role='form'>
  {% csrf_token %}
  <div class="row">
    <div class="col-sm-4">
      <div class="form-group {{ add_form.reference_number.errors|yesno:'has-error,' }}">
        <label class="control-label">Reference Number:</label>
        {{ add_form.reference_number|add_class:"form-control" }}
        {% for error in add_form.reference_number.errors %}
        <p class="help-block">{{ error }}</p>
        {% endfor %}
      </div>
    </div>
    <div class="col-sm-2">
      <div class="form-group">
        <label class="control-label">&nbsp;</label>
        <button class='btn btn-primary form-control'>Add Payout</button>
      </div>
    </div>
  </div>
</form>
{% endif %}

<hr />

<h2>Payouts</h2>

<table class='table table-striped' >
  <thead>
    <th>Payout Reference ID</th>
    <th>Total Revenue</th>
    <th>Product (Revenue)</th>
    <th>Shipping (Revenue)</th>
    <th>Wholesale Cost</th>
    <th id="edit-column">Shipping Cost</th>
    <th>Profit</th>
    <th>Dropified Payout</th>
    <th>TLG Payout</th>
    <th>PLS Payout</th>
    <th>Date</th>
    <th>Status</th>
    <th>Action</th>
  </thead>
  <tbody>
    {% for payout in object_list %}
    <tr>
      <td>
        <a title="Edit" href="{% url 'admin:supplements_payout_change' payout.id %}">
          {{ payout.reference_number }}
        </a>
      </td>
      <td>{{ payout.cost_price_string }}</td>
      <td>{{ payout.cost_price_withuot_shipping_string }}</td>
      <td>{{ payout.shipping_price_string }}</td>
      <td>{{ payout.wholesale_price_string }}</td>
      <td>
        {% if payout.shipping_cost %}
        {{ payout.shipping_cost_string }}
        {% else %}
        <div class="shipping-cost-wrapper editable-column-wrapper" data-payout-id="{{ payout.id }}">
          <input
            class="shipping-cost editable-column"
            type="text" />
        </span>
        {% endif %}
      </td>
      <td>{{ payout.profit_string }}</td>
      <td>{{ payout.profit_split_string }}</td>
      <td>{{ payout.profit_split_string }}</td>
      <td>{{ payout.pls_payout_string }}</td>
      <td>{{ payout.created_at|date:"m.d.Y h:iA" }}</td>
      <td>{{ payout.status_string }}</td>
      <td>
        <a href="{% url 'pls:order_list' %}?refnum={{ payout.reference_number}}">
          View Orders
        </a>
      </td>
    {% empty %}
      <td colspan="9">No payouts yet.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% include "supplements/partials/paging.html" %}

{% endblock %}

{% block extrajs %}
<script type="text/javascript" src="{% static 'libs/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js' %}"></script>
<script type="text/javascript" src="{% static 'pls/js/pls_payment.js' %}"></script>
<script type='application/javascript'>
  $("#id_date").datepicker();
</script>
{% endblock %}
