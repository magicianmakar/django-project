{% extends "supplements/tab_view_admin.html" %}
{% load static %}

{% block extra_pls_css %}
<link href="{% static 'libs/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css' %}" rel="stylesheet">
{% endblock %}

{% block tab_content %}

<div>
  {% include "supplements/partials/line_filter_form.html" %}
</div>

<hr />

<div class="row">

  <div class="col-md-8">
    <h1 style="margin: 0px;">Order Line Items</h1>
  </div>

  <div class="col-md-2 m-t">
    <span id='print-message'></span>
  </div>

  <div class="col-md-2">
    <div class="dropdown">
      <button class="btn btn-default btn-outline dropdown-toggle" type="button" id="dropdownMenu1" >
        Actions
        <span class="caret"></span>
      </button>
      <ul id="store-dropdown-menu" class="dropdown-menu" style="display: none;">
        <li><a href="#" id='print-all-labels'>Print Labels</a></li>
        <li><a href="#" id='mark-all-labels'>Mark as Printed</a></li>
        <li><a href="#" id='unmark-all-labels'>Mark as Not Printed</a></li>
      </ul>
    </div>

  </div>
</div>

<table class="table table-striped m-t">
  <thead>
    <th><input id="select-all-lines" type="checkbox" title="Select all" /></th>
    <th>Order ID</th>
    <th>Line Item SKU</th>
    <th>Label SKU</th>
    <th>Label Size</th>
    <th>Batch</th>
    <th>Fulfillment</th>
    <th>Quantity</th>
    <th>Date</th>
    <th>Status</th>
    <th>Label</th>
  </thead>
  <tbody>
    {% for line_item in object_list %}
    <tr>
      <td>
        <input class="line-checkbox"
               data-id="{{ line_item.id }}"
               type="checkbox" />
      </td>
      <td>
        {{ line_item.pls_order.shipstation_order_number }}
      </td>
      <td>{{ line_item.label.user_supplement.pl_supplement.shipstation_sku }}</td>
      <td>
        <a href="{% url 'pls:admin_label_history' line_item.label.user_supplement.id %}"
            title="View History">
          {{ line_item.label.sku }}</a>
      </td>
      <td>{{ line_item.label.user_supplement.pl_supplement.label_size }}</td>
      <td>{{ line_item.pls_order.batch_number|default:'N/A' }}</td>
      <td>{{ line_item.fulfillment_status_string }}</td>
      <td>{{ line_item.quantity }}</td>
      <td>{{ line_item.created_at|date:"m.d.Y h:iA" }}</td>
      <td>{{ line_item.label_status_string }}</td>
      <td>
        <a href="{% url 'pls:generate_label' line_item.id %}"
          class='download-order-item-label'
          target="_blank"
          data-item-id="{{ line_item.id }}">
          Download
        </a>
      </td>
      <td>
        {% if line_item.is_refunded %}
        <span class="label label-warning">Refunded</span>
        {% else %}
        <span class="label label-primary">Settled</span>
        {% endif %}
      </td>
    {% empty %}
      <td colspan="10">No orders yet.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% include "supplements/partials/paging.html" %}

{% include "supplements/partials/current_label_info_modal.html" %}

{% endblock %}

{% block extrajs %}
<script type="text/javascript" src="{% static 'pls/js/common.js' %}"></script>
<script type="text/javascript" src="{% static 'libs/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js' %}"></script>
<script type="text/javascript" src="{% static 'pls/js/plsorderline_list.js' %}"></script>
{% endblock %}
