{% extends "base.html" %}

{% load static %}

{% block title %}SEO Repport - Projects{% endblock %}

{% block jquery-ui-css %}{% endblock %}

{% block main-container %}

<div class="row">
    <div class="col-md-offset-3 col-md-6">
        <h2 class="text-center">SEO Audit App</h2>

        <div class="panel panel-default">
          <!-- Default panel contents -->
          <div class="panel-heading">All Project</div>
          <!-- List group -->
          <ul class="list-group">
            {% for item in projects %}
            <li class="list-group-item">
                <a href="/project/{{item.id}}">{{item.title}}</a>
                <span class="pull-right">
                    <!-- <a class="edit-project btn btn-xs btn-default" href="/project/{{item.id}}" project-id="{{item.id}}"> <span class="glyphicon glyphicon-edit" title="Edit Project" aria-hidden="true"></span> Edit</a> -->
                    <a class="clone-project btn btn-xs btn-primary" href="#" project-id="{{item.id}}"> <span class="glyphicon glyphicon-new-window" title="Clone Project" aria-hidden="true"></span> Clone</a>
                </span>
            </li>
            {% endfor %}
          </ul>
        </div>

    </div>

    <div class="col-md-offset-3 col-md-6">
        <button xhref="#modal-form" id="add-new-project" class="btn btn-success pull-right" data-toggle="modal"><span class="glyphicon glyphicon-plus" title="Add a new project" aria-hidden="true"></span> New Project</button>
    </div>
</div>

 <div id="modal-form" class="modal fade" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12 ">
                        <h3 class="m-t-none m-b">New Project</h3>
                        <form role="form" id="new-project-form">
                            <div class="form-group"><label>Project Title</label> <input name="title" type="text" placeholder="Enter Project Title" class="form-control"></div>
                            <div class="form-group" id="tpl-select">
                                <label>Clone Template from</label>
                                <select name="template" class="form-control m-b">
                                    {% for item in templates %}
                                    <option value="{{item.id}}">{{item.title}} | {{item.project_set.first}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <button class="project-add btn btn-sm btn-primary pull-right m-t-n-xs"><strong>Add</strong></button>
                                <button class="project-clone btn btn-sm btn-primary pull-right m-t-n-xs"><strong>Clone</strong></button>
                            </div>
                            <input type="hidden" id="src-project" name="src-project"  value="">
                        </form>
                    </div>
            </div>
        </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extrajs%}
<script type="text/javascript">
$(function () {
    $('#add-new-project').click(function() {
        $('#modal-form').modal();
        $('#tpl-select').show();

        $('#modal-form .project-add').show();
        $('#modal-form .project-clone').hide();

    });

    $('.clone-project').click(function() {
        $('#modal-form .project-add').hide();
        $('#modal-form .project-clone').show();

        $('#tpl-select').hide();
        $('#src-project').val($(this).attr('project-id'));
        $('#modal-form').modal();
    });

    $('#modal-form .project-add').click(function(e) {
        e.preventDefault();
        $.ajax({
            context: this,
            type: 'POST',
            url: '/api/add-project',
            data: $('#new-project-form').serialize(),
            success: function (data) {
                if(data.startsWith('/project/')) {
                    window.location.href = data;
                } else {
                    alert('Inknow Error');
                }
            },
            error: function (data) {
                alert('Unknown Error, please try again.')
            }
        });
    });

    $('#modal-form .project-clone').click(function() {
        e.preventDefault();
        $.ajax({
            context: this,
            type: 'POST',
            url: '/api/clone-project',
            data: $('#new-project-form').serialize(),
            success: function (data) {
                if(data.startsWith('/project/')) {
                    window.location.href = data;
                } else {
                    alert('Inknow Error');
                }
            },
            error: function (data) {
                alert('Unknown Error, please try again.')
            }
        });
    });
});
</script>
{% endblock %}
