!function(AV,window,document){var eventSplitter,Events,mediator,Ea,Fa,Ga,Ia,dn,$f,_f,ag,bg,cg,dg_lighting,dg_color,eg,fg,gg,ig,lg,mg,ng,pg,qg,rg,Ej,Fj,Hj,Ij,Jj,Lj,Mj,Pj,Vi,Ei,Fi,Gi,Hi,Ji
AV.build={contentShouldUseStaging:!1,version:"4.3.1",bundled:!1,feather_baseURL:"/static/libs/csdk/4.x/",feather_baseURL_SSL:"/static/libs/csdk/4.x/",cdsContentURL:"/static/libs/csdk/4.x/cds",cdsContentURL_SSL:"/static/libs/csdk/4.x/cds",manifestURL:"/static/libs/csdk/4.x/manifest",manifestURL_SSL:"/static/libs/csdk/4.x/manifest",feather_stickerURL:"http://feather.aviary.com/stickers/",feather_stickerURL_SSL:"https://dme0ih8comzn4.cloudfront.net/stickers/",imgrecvBase:"https://featherservices.aviary.com/",imgrecvBase_SSL:"https://featherservices.aviary.com/",featherTargetAnnounce:"https://featherservices.aviary.com/feather_target_announce_v3.html",featherTargetAnnounce_SSL:"https://featherservices.aviary.com/feather_target_announce_v3.html",imgrecvServer:"https://featherservices.aviary.com/FeatherReceiver.aspx",imgrecvServer_SSL:"https://featherservices.aviary.com/FeatherReceiver.aspx",imageToBase64Endpoint:"https://api-ag.aviary.com/utilities/image-to-data-uri?url=",jsonp_imgserver:"https://featherservices.aviary.com/imgjsonpserver.aspx",jsonp_imgserver_SSL:"https://featherservices.aviary.com/imgjsonpserver.aspx",s3SignedURLGenerator:"https://api-ag.aviary.com/utilities/signed-s3-url?type=feather&content_type=image/png",proxyServer:"https://featherservices.aviary.com/proxy.aspx",proxyServer_SSL:"https://featherservices.aviary.com/proxy.aspx",asyncImgrecvBase:"http://cc-api-aviary-cds.adobe.io/",asyncImgrecvBase_SSL:"https://cc-api-aviary-cds.adobe.io/",gatewayAssetURL:"http://cc-api-aviary-cds.adobe.io",gatewayAssetURL_SSL:"https://cc-api-aviary-cds.adobe.io",asyncFeatherTargetAnnounce:"http://cc-api-aviary-cds.adobe.io/feather_target_announce_v3.html",asyncFeatherTargetAnnounce_SSL:"https://cc-api-aviary-cds.adobe.io/feather_target_announce_v3.html",asyncImgrecvCreateJob:"http://cc-api-aviary-cds.adobe.io/v2/createjob",asyncImgrecvCreateJob_SSL:"https://cc-api-aviary-cds.adobe.io/v2/createjob",asyncImgrecvGetJobStatus:"http://cc-api-aviary-cds.adobe.io/v2/getjobstatus",asyncImgrecvGetJobStatus_SSL:"https://cc-api-aviary-cds.adobe.io/v2/getjobstatus",googleTracker:"UA-138234207-3",inAppPurchaseFrameURL:"http://purchases.viary.com/gateway.aspx?p=flickr"},eventSplitter=/\s+/,Events=AV.Events={on:function(e,t,a){var n,o
if(!t)return this
for(e=e.split(eventSplitter),n=this._callbacks||(this._callbacks={});o=e.shift();)(n[o]||(n[o]=[])).push(t,a)
return this},off:function(e,t,a){var n,o,i,r
if(!(o=this._callbacks))return this
if(!(e||t||a))return delete this._callbacks,this
for(e=e?e.split(eventSplitter):_.keys(o);n=e.shift();)if((i=o[n])&&(t||a))for(r=i.length-2;0<=r;r-=2)t&&i[r]!==t||a&&i[r+1]!==a||i.splice(r,2)
else delete o[n]
return this},trigger:function(e){var t,a,n,o,i,r,s,c
if(!(a=this._callbacks))return this
for(c=[],e=e.split(eventSplitter),o=1,i=arguments.length;o<i;o++)c[o-1]=arguments[o]
for(;t=e.shift();){if((s=a.all)&&(s=s.slice()),(n=a[t])&&(n=n.slice()),n)for(o=0,i=n.length;o<i;o+=2)n[o].apply(n[o+1]||this,c)
if(s)for(r=[t].concat(c),o=0,i=s.length;o<i;o+=2)s[o].apply(s[o+1]||this,r)}return this}},void 0===AV&&(AV={}),AV.JSON={},function(){"use strict"
function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e]
return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var a,n,o,i,r,s=gap,c=t[e]
switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c)
case"number":return isFinite(c)?String(c):"null"
case"boolean":case"null":return String(c)
case"object":if(!c)return"null"
if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(c)){for(i=c.length,a=0;a<i;a+=1)r[a]=str(a,c)||"null"
return o=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+s+"]":"["+r.join(",")+"]",gap=s,o}if(rep&&"object"==typeof rep)for(i=rep.length,a=0;a<i;a+=1)"string"==typeof(n=rep[a])&&((o=str(n,c))&&r.push(quote(n)+(gap?": ":":")+o))
else for(n in c)Object.hasOwnProperty.call(c,n)&&((o=str(n,c))&&r.push(quote(n)+(gap?": ":":")+o))
return o=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+s+"}":"{"+r.join(",")+"}",gap=s,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()})
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep
"function"!=typeof AV.JSON.stringify&&(AV.JSON.stringify=function(e,t,a){var n
if(indent=gap="","number"==typeof a)for(n=0;n<a;n+=1)indent+=" "
else"string"==typeof a&&(indent=a)
if((rep=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("AV.JSON.stringify")
return str("",{"":e})}),"function"!=typeof AV.JSON.parse&&(AV.JSON.parse=function(text,reviver){function walk(e,t){var a,n,o=e[t]
if(o&&"object"==typeof o)for(a in o)Object.hasOwnProperty.call(o,a)&&(void 0!==(n=walk(o,a))?o[a]=n:delete o[a])
return reviver.call(e,t,o)}var j
if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j
throw new SyntaxError("AV.JSON.parse")})}(),AV.validLanguages={en:!0,bg:!0,ca:!0,zh_hans:!0,zh_hant:!0,cs:!0,da:!0,nl:!0,fi:!0,fr:!0,de:!0,he:!0,id:!0,it:!0,ja:!0,ko:!0,lv:!0,lt:!0,pl:!0,pt:!0,pt_br:!0,ru:!0,es:!0,sv:!0,tr:!0,vi:!0,el:!0,hu:!0,no:!0,sk:!0,uk:!0},AV.util={getScaledDims:function(e,t,a,n){n=n||a
var o=e,i=t,r=e/t
return(a<e||n<t)&&(i=r*(t-n)<e-a?(o=a)*t/e+.5|0:(o=n*r+.5|0,n)),{width:o,height:i}},getTouch:function(e){return e.originalEvent&&(e=e.originalEvent),e.changedTouches&&1==e.changedTouches.length?e.changedTouches[0]:!(!e.touches||1!=e.touches.length)&&e.touches[0]},nextFrame:function(e){setTimeout(e,1)},getDomain:function(e,t){var a,n,o,i,r,s
return a="http://"==e.substr(0,7)?7:"https://"==e.substr(0,8)?8:"ftp://"==e.substr(0,6)?6:0,-1==(o=e.indexOf("/",a))&&(o=e.length),n=t?a:(a<(s=e.lastIndexOf(":"))?e.substring(a,s):e.substring(a,o)).match(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/)?a:(i=e.lastIndexOf(".",o),-1==(r=e.lastIndexOf(".",i-1))?a:r+1),e.substring(n,o)},extend:function(){var e,t,a,n,o,i,r=arguments[0]||{},s=1,c=arguments.length,l=!1
for("boolean"==typeof r&&(l=r,r=arguments[1]||{},s=2),"object"==typeof r||jQuery.isFunction(r)||(r={}),c===s&&(r=this,--s);s<c;s++)if(null!=(e=arguments[s]))for(t in e)a=r[t],r!==(n=e[t])&&(l&&n&&(jQuery.isPlainObject(n)||(o=jQuery.isArray(n)))?(i=o?(o=!1,a&&jQuery.isArray(a)?a:[]):a&&jQuery.isPlainObject(a)?a:{},r[t]=jQuery.extend(l,i,n)):void 0!==n&&(r[t]=n))
return r},findItemByKeyValueFromArray:function(e,t,a){var n,o
for(a.length,n=0;n<a.length;n++)if(a[n]&&a[n][e]&&a[n][e]===t){o=a[n]
break}return o},loadFile:(Ia=0,Ea=function(e,t){t&&("Microsoft Internet Explorer"==navigator.appName?e.onreadystatechange=function(e){(4==this.readyState||"complete"==this.readyState||"loaded"==this.readyState)&&t(e)}:e.onload=t)},function(e,t,a){var n
return"js"==t?((n=document.createElement("script")).setAttribute("type","text/javascript"),Ea(n,a),n.setAttribute("src",e)):"css"==t?document.createStyleSheet?document.createStyleSheet(e,Ia++):((n=document.createElement("link")).setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e)):"img"==t&&(n=document.createElement("img"),Ea(n,a),n.setAttribute("src",e)),n&&(Fa=Fa||document.getElementsByTagName("head")[0],"js"==t?Fa.appendChild(n):"css"==t&&((Ga=Ga||document.createDocumentFragment()).appendChild(n),Fa.insertBefore(n,void 0))),n}),getImageElem:function(e){return"string"==typeof e?document.getElementById(e):e.length?e[0]:e},getImageId:function(e){return"string"==typeof e?e:e.id},imgOnLoad:function(e,t){var a=avpw$(e)
a.load(t),(1==a[0].complete||4==a[0].readyState||"complete"==a[0].readyState||"loaded"==a[0].readyState)&&a.trigger("load")},color_is_white:function(e){return"#fff"==(e=e.toLowerCase())||"#ffffff"==e||"white"==e||"rgb(255,255,255)"==e||"rgb(255, 255, 255)"==e},color_is_light:function(e){var t
return 0,127.5<.2*(t=AV.util.color_to_array(e))[0]+.7*t[1]+.1*t[2]},color_expand:function(e){var t,a,n
return 4==e.length&&(e="#"+(t=e.charAt(1))+t+(a=e.charAt(2))+a+(n=e.charAt(3))+n),e},color_to_array:function(e){var t,a,n
return"#"==e.charAt(0)?(e=AV.util.color_expand(e),t=parseInt(e.substr(1,2),16),a=parseInt(e.substr(3,2),16),n=parseInt(e.substr(5,2),16)):"r"==e.charAt(0).toLowerCase()&&(e=AV.util.rgb_to_color(e),t=parseInt(e.substr(1,2),16),a=parseInt(e.substr(3,2),16),n=parseInt(e.substr(5,2),16)),[t,a,n,1]},array_to_color:function(e){var t=AV.util.array_to_rgb(e)
return AV.util.rgb_to_color(t)},array_to_rgb:function(e){var t="rgb(0,0,0)"
return e.join&&(3<e.length&&(e=e.slice(0,3)),t="rgb("+e.join(",")+")"),t},color_to_rgb:function(e){return e=AV.util.color_to_array(e),AV.util.array_to_rgb(e)},rgb_to_color:function(e){var t,a,n,o=e.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/)
return o?(1==(t=parseInt(o[1]).toString(16)).length&&(t="0"+t),1==(a=parseInt(o[2]).toString(16)).length&&(a="0"+a),1==(n=parseInt(o[3]).toString(16)).length&&(n="0"+n),"#"+t+a+n):e},color_to_int:function(e){return e=AV.util.color_expand(e),e=AV.util.rgb_to_color(e),parseInt(e.substr(1),16)},getSafeAssetBaseURL:function(e){return e=e.replace("http://cd-test.aviary.com:1338",AV.build.cdsContentURL),"https:"==window.location.protocol&&(e=AV.build.contentShouldUseStaging?e.replace("http://testassets.aviary.com.s3.amazonaws.com","https://s3.amazonaws.com/testassets.aviary.com"):e.replace("http://assets.aviary.com","https://assets.aviary.com")),e},loadImagesSync:function(n,e,t){var a,o=0,i=n.length,r=function(){e&&o==n.length&&AV.util.nextFrame(e)},s=avpw$.support.cors&&!("Microsoft Internet Explorer"==navigator.appName)||t
for(-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&(s=!1),a=0;a<i;a++)!function(e){var t=n[e].img,a=n[e].src
t.onload=function(){n[e].mappingObject&&(n[e].mappingObject.w=t.width,n[e].mappingObject.h=t.height),o++,r()},s?(t.crossOrigin="Anonymous",t.src=a):avpw$.ajax({type:"GET",dataType:"json",url:AV.build.jsonp_imgserver+"?callback=?",data:{url:escape(a)},success:function(e){t.src=e.data}})}(a)},getApiVersion:function(e){return e&&e.apiVersion?parseInt(e.apiVersion,10):1},getUserFriendlyToolName:function(e){var t=""
return e&&(t={overlay:"Stickers",drawing:"Draw",textwithfont:"Text",colorsplash:"Splash",tiltshift:"Tilt Shift",forcecrop:"Crop"}[e]||e.substr(0,1).toUpperCase()+e.substr(1)),t},keyDownHandlerNumber:function(e,t){9==e.keyCode||27==e.keyCode||65==e.keyCode&&(!0===e.ctrlKey||!0===e.metaKey)||35<=e.keyCode&&e.keyCode<=39||((e.keyCode<48||57<e.keyCode)&&(e.keyCode<96||105<e.keyCode)&&46!==e.keyCode&&8!==e.keyCode?e.preventDefault():t&&t.apply(this,[e]))},getBrowserVersion:function(){var e,t=navigator.userAgent,a=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[]
return/trident/i.test(a[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===a[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?"Opera "+e[1]:(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&a.splice(1,1,e[1]),a[1])},generatePointList:function(e,t){var a,n,o,i,f=function(e,t,a,n,o,i,r,s){var c,l,g,u,d,h,p=(n-t)*(n-t)+(o-a)*(o-a)
if(p<s*s)return null
h=void 0!==i?(d=((c=(i+t)/2)+(l=(i+n)/2))/2,((g=(r+a)/2)+(u=(r+o)/2))/2):(d=(t+n)/2,(a+o)/2),f(e,t,a,d,h,c,g,s),e.push([0|d,0|h]),f(e,d,h,n,o,l,u,s)},r=Math.floor(.2*t),s=0,c=[]
for(s=0;s<e.length-1;++s)n=e[s],o=e[s+1],i=[(n[0]+o[0])/2|0,(n[1]+o[1])/2|0],0===s?f(c,n[0],n[1],i[0],i[1],void 0,void 0,r):f(c,a[0],a[1],i[0],i[1],n[0],n[1],void 0,void 0,r),a=i,c.push(i),s===e.length-2&&(f(c,i[0],i[1],o[0],o[1],void 0,void 0,r),c.push(o))
return c},isURLSameDomain:function(e){var t=window.location,a=document.createElement("a")
return a.href=e,a.hostname==t.hostname&&a.port==t.port&&a.protocol==t.protocol},doesSupportImageCORS:function(){return avpw$.support.cors&&!("Microsoft Internet Explorer"==navigator.appName)},isIE11:function(){return!window.ActiveXObject&&"ActiveXObject"in window||/Edge\/([0-9]+)./i.test(navigator.userAgent)}},function(e,t,a){e.AV=e.AV||{}
var r=e.AV
r.ImageSizeTracker=function(e){var i=this
i.setImageScaledIndicator=function(){r.controlsWidgetInstance.layoutNotify(r.launchData.openType,"updateImageScaledIndicator")},i.setOrigSize=function(e,t,a){var n,o
if(e.hiresWidth&&e.hiresHeight)n=parseInt(e.hiresWidth,10),o=parseInt(e.hiresHeight,10)
else if(e.hiresUrl)n=t.width,o=t.height
else{if(!e.displayImageSize)return null
n=a.width,o=a.height}return r.paintWidgetInstance.actions.setOrigSize(n,o),i.setImageScaledIndicator(),{width:n,height:o}},i.isDisplayingImageSize=function(e){return e.hiresWidth||e.hiresHeight||e.displayImageSize},i.isUsingHiResDimensions=function(e){return e.hiresWidth||e.hiresHeight||e.displayImageSize&&e.hiresUrl}}}(this),mediator=AV.Events,AV.ToolManager=function(i){var n,t,o=null,r=function(e,t,a){return i.objectNotify("tool",e,t,a)},s=(t=function(e){var t,a
r(o,"panelWillClose"),r(e,"panelWillOpen"),mediator.trigger("canvas:activate",i.panelMode2WidgetMode(e)),null!=(a=e)&&(avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()}),avpw$("#avpw_controlpanel_"+a).show()),r(e,"resetUI"),window.setTimeout((t=o,function(){r(t,"panelDidClose"),r(o=e,"panelDidOpen"),n=!1}),200),o=e,i.layoutNotify(AV.launchData.openType,"disableZoomMode")},function(e){n||(n=!0,t(e))}),e=function(){mediator.on("tool:open",l),mediator.on("tool:close",c),mediator.on("tool:init",g),mediator.on("tool:shutdown",h),mediator.on("tool:commit",u),mediator.on("tool:cancel",d),mediator.on("tool:undo",p),mediator.on("tool:redo",f),mediator.on("actions:clear_uncommited_changes",a)},a=function(){i.paintWidget.hasUncommittedChanges&&(i.paintWidget.actions.undo(),i.paintWidget.hasUncommittedChanges=!1,i.paintWidget.actions.truncate(!0))},c=function(){i.layoutNotify(AV.launchData.openType,"showView",["main"]),s(null)},l=function(e,t){(function(e){var t,a,n=i.activeTools,o=!1
if(n)for(a=n.length,t=0;t<a;t++)if(n[t]===e){o=!0
break}return!("forcecrop"!==e||!AV.launchData.forceCropPreset)||(o||AV.errorNotify("UNSUPPORTED_TOOL",[e]),o)}(e=AV.publicName2PanelMode(e))||AV.launchData.forceCropPreset)&&i.paintWidget&&!i.paintWidget.moduleLoaded(e,function(e){AV.util.nextFrame(function(){!function(e){if(!i.paintWidget||!i.paintWidget.busy){if(i.layoutNotify(AV.launchData.openType,"showView",["editpanel"]),s(e),AV.controlsWidgetInstance.onEggWaitThrobber.stop(),"mobile"==AV.launchData.openType){var t,a=document.getElementById("avpw_main_"+e)
a&&(t=a.getAttribute("data-header"))&&(document.getElementById("avpw_control_toolname").innerHTML=t)}AV.usageTracker.addUsage(e)}}(e)})})&&t&&(i.onEggWaitThrobber.stop(),i.onEggWaitThrobber.spin(avpw$(t).children(".avpw_icon_waiter")[0])),mediator.trigger("usage:tool",e,"opened"),mediator.trigger("usage:firstclick",e)},g=function(e){r(e,"init",[i])},u=function(){var e,t=o
t&&(!1!==(e=r(o,"commit"))&&(mediator.trigger("usage:tool",t,"applied",!0!==e?e:""),mediator.trigger("tool:commitDone")))},d=function(){r(o,"cancel"),mediator.trigger("usage:tool",o,"canceled"),mediator.trigger("actions:clear_uncommited_changes")},h=function(e){r(e,"shutdown")},p=function(){mediator.trigger("usage:tool","undo","applied",o||""),i.paintWidget.busy||!1===r(o,"onUndo")||(i.paintWidget.actions.undo(),r(o,"onUndoComplete"))},f=function(){mediator.trigger("usage:tool","redo","applied",o||""),i.paintWidget.busy||!1===r(o,"onRedo")||(i.paintWidget.actions.redo(!1,!0),r(o,"onRedoComplete"))},b=this
return b.init=e,b.shutdown=function(){mediator.off("tool:open",l),mediator.off("tool:close",c),mediator.off("tool:init",g),mediator.off("tool:shutdown",h),mediator.off("tool:commit",u),mediator.off("tool:cancel",d),mediator.off("tool:undo",p),mediator.off("tool:redo",f),mediator.off("actions:clear_uncommited_changes",a)},b.notify=r,b.getActiveTool=function(){return o},e(),b},AV.AssetManager=function(e,t){"use strict"
var n,a,o={EFFECT:"effects",STICKER:"stickers",IMAGEBORDER:"frames",OVERLAYS:"overlays",PERMISSION:"permissions",FONTPACK:"fontpack"},i={},r=function(e){return n[o[e]]||[]},s=function(e,t){return n=[{needsPurchase:!1,assetId:"default_effects",assetType:"effect",displayName:"Default",resourceUrl:"js/proclist_default_effects.js"},{needsPurchase:!1,assetId:"original_effects",assetType:"effect",displayName:"Original",resourceUrl:"js/proclist_original_effects.js"},{needsPurchase:!1,assetId:"original_stickers",assetType:"sticker",displayName:"Original",resourceUrl:"js/stickers_original_stickers.js"},{needsPurchase:!1,assetId:"borders",assetType:"imageborder",displayName:"Default Image Borders",resourceUrl:"js/borders_original.js"}],t&&AV.util.nextFrame(function(){t.apply(this,[r(e)])}),!0},c=e?function(t,a){n?a&&a.apply(this,[r(t),o[t]]):(i.getPartnerAssets||(i.getPartnerAssets=[],l.authenticate()),i.getPartnerAssets.push(function(e){e&&e.status&&"Ok"===e.status?n=e:(AV.errorNotify("ERROR_AUTHENTICATING"),s()),AV.util.nextFrame(function(){n&&a&&a.apply(this,[r(t),o[t]])})}))}:s,l=this
return l.getAssets=c,l.getById=function(e){for(var t=0;t<n.length;t++)if(n[t].assetId===e)return n[t]},l.gatherContentAssetsHelper=function(e,g){return l.getAssets(e,function(e){var n,t,o,i,a,r,s,c,l
for(n={},t=e,o={},i=function(){r===t.length&&g(o,t)},a=function(t,a){return AV.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_get_assetssticker",action:a,method:"GET",dataType:"json",announcer:AV.build.asyncFeatherTargetAnnounce,origin:AV.build.asyncImgrecvBase,callback:function(e){o[t]=e,n[a]=!0,r++,i()}})},s=r=0;s<t.length;s++)c=t[s].identifier,l=AV.controlsWidgetInstance.assetManager.getContentURLByVersionKey(t[s].versionKey),n[l]?(r++,i()):!o[c]&&l&&a(c,l)})},l.getManifestURL=function(){var e,t,a=AV.build.contentShouldUseStaging
return AV.launchData.apiKey&&AV.launchData.timestamp&&AV.launchData.signature&&AV.launchData.salt&&AV.launchData.encryptionMethod?(e=AV.build.gatewayAssetURL,t=["&timestamp=",AV.launchData.timestamp,"&signature=",AV.launchData.signature,"&salt=",AV.launchData.salt,"&encryptionMethod=",AV.launchData.encryptionMethod].join("")):e=AV.build.manifestURL,[e,"/hires/assets","?platform=web","&apiKey=",AV.launchData.apiKey||"","&resolution=",1<window.devicePixelRatio?"high":"low","&sdkVersion="+AV.build.version,a?"&staging=2":"",t||""].join("")},l.getContentURLByVersionKey=function(e){var t=AV.build.contentShouldUseStaging
return AV.build.cdsContentURL+"/v1/content?versionKey="+e+(t?"&staging=2":"")},l.authenticate=(a=function(e){!function(e){var t,a,n
if(e.messageName&&(n=i[e.messageName])){if("function"==typeof n)n.apply(this,[e.data])
else for(a=n.length,t=0;t<a;t++)n[t].apply(this,[e.data])
n=null}}({messageName:"getPartnerAssets",data:e})},function(){return AV.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_auth_form",action:l.getManifestURL(),method:"GET",dataType:"json",announcer:AV.build.asyncFeatherTargetAnnounce,origin:AV.build.asyncImgrecvBase,callback:a,onError:function(e){AV.errorNotify(e.status&&403==e.status?"ERROR_AUTHENTICATING":"ERROR_GET_ASSETS")}})}),l.types=o,l},AV.ServerMessaging=function(e){var r=[],u=function(e,t){var a,n,o=!0,i=r.shift()
if(i&&(t&&i.origin&&(o=t===AV.util.getDomain(i.origin)),i.id&&(n=(a=avpw$("#"+i.id)).attr("target"),avpw$("#"+n).unbind("load"),avpw$("#"+i.id+"_target_holder").empty(),a.remove()),o&&i.callback)){if(i.dataType&&"json"===i.dataType&&"string"==typeof e)try{e=AV.JSON.parse(e)}catch(e){}i.callback.call(this,e)}0<r.length&&s()},d=function(e,t,a){return a||(a=AV.build.feather_baseURL+"blank.html"),t||(t=e),['<iframe width="1" height="1" ','style="position:absolute;left:-9999px;" ','id="'+e+'" name="'+t+'" src="'+a+'">',"</iframe>"].join("")},t=function(e,t,a,n,o,i,r){var s,c=function(e,t,a){if(!e)return null
var n=e+"_target_holder",o="avpw_form_target_"+Math.floor(4294967295*Math.random()).toString(16),i=avpw$("#"+n)
return i&&i.length||(i=avpw$('<div id="'+n+'"></div>').css({position:"absolute",top:0,left:0}).appendTo("#avpw_holder")),i.html(d(o)),avpw$("#"+o).load(t?function(){l(o,e,t)}:a),o}(e,i,r)
return(s=function(e,t,a,n,o){var i,r=avpw$("<form></form>").attr({id:e,action:t,target:a,method:n||"POST"}).css({display:"none"}),s=document.createDocumentFragment()
for(i in o)o.hasOwnProperty(i)&&s.appendChild(avpw$("<input></input>").attr({name:i,value:o[i],type:"hidden"})[0])
return r.html(s),r.appendTo("#avpw_holder"),r}(e,t+="?responsecontenttypeheader="+escape("text/html"),c,a,o)).submit(),s},l=function(e,t,a){var n,o,i,r,s,c,l,g=t+"_announcer"
window.postMessage?window[g]?window[g].postMessage("avpw_load:"+e,"*"):((n=avpw$(d(g,g,a))).load(function(){AV.util.nextFrame(function(){window[g].postMessage("avpw_load:"+e,"*")})}),avpw$("#avpw_holder").append(n)):(i=function(){avpw$(o).unbind().remove()},s=r=t+"_observer",c=0,l=function(){var e
try{if("about:blank"==o.contentWindow.location)return}catch(e){}2===c&&((e=o.contentWindow.name)&&(c=3,e!==s&&e.substr&&"avpw:"==e.substr(0,5)?(e=e.substr(5),u(e)):(AV.errorNotify("ERROR_SAVING",[AV.build.imgrecvServer]),u()),i())),1===c&&(c=2,o.contentWindow.location=""),c||(c=1)},o=avpw$(d(r,s,a+"#"+e))[0],avpw$(o).load(l),avpw$(o).appendTo("#avpw_holder"))},a=function(e){var t=e.data,a=AV.util.getDomain(e.origin)
t.substr&&"avpw:"==t.substr(0,5)&&(t=t.substr(5),u(t,a))},s=function(){var e=r[0]
e&&t(e.id,e.action,e.method,e.origin,e.keyValues,e.announcer)},h=function(e){e.announcer?(r.push(e),1===r.length&&s()):t(e.id,e.action,e.method,e.origin,e.keyValues,e.announcer,e.callback)}
return this.shutdown=function(){window.removeEventListener?window.removeEventListener("message",a,!1):window.detachEvent&&window.detachEvent("onmessage",a),r=[]},this.sendMessage=function(e){var t,a,n,o,i,r,s,c,l,g,u,d
"xhr"===(e.transport||"xhr")&&avpw$.support.cors&&(!AV.firefox||4<=AV.firefox)?(s=e.action,c=e.method,l=e.keyValues,g=e.dataType,u=e.callback,d=e.onError,avpw$.ajax({url:s,type:c,data:l,dataType:g,error:function(e){d?d.call(this,e):AV.errorNotify("ERROR_SERVER_MESSAGING",[s])},success:u})||h(e)):"function"==typeof XDomainRequest?(t=e.action,a=e.method,n=e.keyValues,e.dataType,o=e.callback,i=e.onError,(r=new XDomainRequest).onload=function(){var t=r.responseText
window.setTimeout(function(){var e
try{e=AV.JSON.parse(t),o(e)}catch(e){o(t)}},0)},r.onerror=function(e){i?i.call(this,e):AV.errorNotify("ERROR_SERVER_MESSAGING",[t]),AV.errorNotify("ERROR_SERVER_MESSAGING",[t])},r.ontimeout=function(){},r.onprogress=function(){},r.open(a,t),n?r.send(avpw$.param(n)):r.send()):h(e)},window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("onmessage",a),this},$f=this,_f=void 0!==window?window:{},ag=void 0!==document?document:{},$f.AV=$f.AV||{},bg=$f.AV,cg=bg.Events,bg.usageTracker=(fg=null,gg={},ig=[],lg=!1,ng=function(){bg.controlsWidgetInstance&&mg.submit("close")},pg=function(e,t,a){AV_ga("send","event","tool",e+":"+t,a?a+"":"")},qg=function(e,t,a){AV_ga("send","event","interaction",e+":"+t,a?a+"":"")},rg=function(e){mg.submit("firstclick",e),cg.off("usage:firstclick")},(mg={}).setup=function(){avpw$(_f).bind("unload",ng),cg.on("usage:submit",mg.submit,mg),cg.on("usage:tool",pg,mg),cg.on("usage:firstclick",rg,mg),cg.on("usage:interact",qg)},mg.shutdown=function(){avpw$(_f).unbind("unload",ng),cg.off("usage:submit",mg.submit),cg.off("usage:tool",pg),cg.off("usage:firstclick",rg),cg.off("usage:interact",qg)},mg.clear=function(){fg=null,gg={},ig=[]},mg.getUUID=function(){return fg||(fg=Math.floor(4294967295*Math.random()).toString(16)+Math.floor(4294967295*Math.random()).toString(16))},mg.addUsage=function(e,t){t||(t=1),void 0===gg[e]?gg[e]=t:gg[e]+=t},mg.setPageCount=function(e){var t
for(ig=new Array(e),t=0;t<e;t++)ig[t]=0},mg.addPageHit=function(e){e!==eg&&ig[e]++,eg=e},mg.submit=function(e,t){(function(){var e,t,a,n,o
lg||(t=ag,a="AV_ga",(e=_f).GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,n=t.createElement("script"),o=t.getElementsByTagName("script")[0],n.async=1,n.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(n,o),AV_ga("create",bg.build.googleTracker,"auto",{allowLinker:!0}),AV_ga("set","dimension1",bg.launchData.apiKey),AV_ga("set","dimension2",bg.build.version),AV_ga("set","dimension3",this.getUUID()),AV_ga("set","dimension4",bg.launchData.language),AV_ga("set","dimension5",bg.launchData.apiVersion+""),lg=!0,AV_ga("send","event","editor","isWebGLUsed",bg.featherGLEnabled.toString()))}).call(this),"launch"===e?AV_ga("send","pageview",(_f.location||"").toString()):AV_ga("send","event","submit",e,t)},mg),dg_lighting={brightness:!0,contrast:!0},dg_color={saturation:!0,warmth:!0},bg.getActiveTools=function(e){var t,a,n,o,i,r,s=bg.featherUseFlash?bg.flashSupportedTools:bg.featherGLEnabled?bg.glSupportedTools:bg.defaultTools,c=e
for(c&&"all"!==c&&"All"!==c&&"ALL"!==c&&""!==c||(c=s),"string"==typeof c&&(c=e.split(",")),n=[],o={},i={},a=0;a<s.length;a++)i[t=s[a]]=!0
for(r=!0,a=0;a<c.length;a++){if(bg.launchData.forceCropPreset){if("resize"===c[a]||"orientation"===c[a]||"crop"===c[a]||"overlays"===c[a])continue}else if("orientation"===c[a]&&avpw$.browser.msie&&9===parseInt(avpw$.browser.version))continue;(t=bg.publicName2PanelMode(c[a]))in i?(n.push(t),r=!1,o[t]=!0):!o.lighting&&dg_lighting[t]?(n.push("lighting"),r=!(o.lighting=!0)):!o.color&&dg_color[t]&&(n.push("color"),r=!(o.color=!0))}return bg.launchData.forceCropPreset&&r&&bg.errorNotify("BAD_FORCECROP_TOOLS"),n},bg.paintWidgetGetPopupEmbedDiv=function(e){var t,a,n,o,i,r,s=avpw$("#avpw_canvas_embed_popup")
if(e){for(o=avpw$(e),i=["top","left","bottom","right","margin-top","margin-right","margin-bottom","margin-left","border-top","border-right","border-bottom","border-left","padding-top","padding-right","padding-bottom","padding-left"],r={position:"relative"},a=0;a<i.length;a++)r[n=i[a]]=o.css(n);(""==(t=avpw$(e).css("display"))||"inline"==t)&&(t="inline-block"),r.display=t,0==s.length&&((s=ag.createElement("div")).id="avpw_canvas_embed_popup"),avpw$(s).hide().css(r).insertBefore(e)}return s},bg.paintWidgetLauncher=function(e,t){return bg.paintWidgetInstance?void 0:(bg.usageTracker.clear(),bg.paintWidgetLauncher_HTML(e,t))},bg.paintWidgetLauncher_HTML=function(e,t){var a,n,o,i,r,s=bg.launchData.launchDelay,c=bg.util.getImageElem(e)
return i=bg.getActiveTools(bg.launchData.tools),bg.isRelaunched&&void 0!==c.avpw_prevURL&&(t=c.avpw_prevURL),r=new bg.AssetManager(bg.launchData.isPremiumPartner,bg.launchData.allowInAppPurchase),bg.controlsWidgetInstance=new bg.ControlsWidget(null,e,i,r,new bg.ServerMessaging),bg.launchData.image instanceof HTMLImageElement&&!t&&(t=e.src),t&&0===t.indexOf("//")&&(t=ag.location.protocol+t),bg.controlsWidgetInstance.origURL=t||avpw$(c).attr("src"),bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"placeControls",[1<bg.util.getApiVersion(bg.launchData)?bg.launchData.appendTo:void 0]),bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"enableControls"),bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"bindEvents"),avpw$("#avpw_controls").fadeIn(s),bg.util.nextFrame(function(){bg.controlsWidgetInstance.setupScrollPanels()}),bg.launchData.noCloseButton&&avpw$("#avpw_control_cancel_pane").css("display","none"),c&&"canvas"===c.nodeName.toLowerCase()?void bg.mockLauncher(c):(n=bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"getEmbedElement",[c]),(a=ag.createElement("img")).id="avpw_temp_loading_image",bg.tempLoadingImageSrc=a.src,avpw$(a).load(function(){o=bg.controlsWidgetInstance.getScaledDims(avpw$(c).width(),avpw$(c).height()),a.width=o.width,a.height=o.height,bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"getScaledImageDims",[a]),avpw$(a).unbind(),a.style.display="block",avpw$(n).append(a),bg.controlsWidgetInstance.showWaitThrobber(!0),bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"hideOriginalImage",[c]),avpw$(n).show(),bg.util.nextFrame(function(){bg.paintWidgetLauncher_stage2(e,t)})}).error(function(){bg.paintWidgetCloser(!0),bg.errorNotify("BAD_IMAGE",[t])}),a.src=c.src,!1)},bg.resetImageControls=function(){var e=bg.paintWidgetInstance.imgElementClean,t=bg.controlsWidgetInstance.getScaledDims(e.width,e.height)
bg.controlsWidgetInstance.imageSizeTracker.setOrigSize(bg.launchData,e,t),bg.paintWidgetInstance.setDimensions(t.width,t.height),bg.paintWidgetInstance.setBackground(e),bg.paintWidgetInstance.setOrigSize(t.width,t.height)},bg.paintWidgetLauncher_stage2=function(e,n){var t,a,o=bg.util.getImageElem(e),i=function(e){bg.controlsWidgetInstance&&bg.paintWidgetInstance&&(t=new Image,avpw$.support.cors&&bg.launchData.enableCORS&&-1===e.indexOf("data:")&&(t.crossOrigin="Anonymous"),avpw$(t).load(function(e){if(bg.controlsWidgetInstance&&bg.paintWidgetInstance){if(r=bg.controlsWidgetInstance.getScaledDims(t.width,t.height),bg.controlsWidgetInstance.imageSizeTracker.setOrigSize(bg.launchData,t,r),t.width=r.width,t.height=r.height,bg.paintWidgetInstance.setDimensions(r.width,r.height),!bg.paintWidgetInstance.setBackground(t))return bg.paintWidgetCloser(!0),bg.errorNotify("IMAGE_NOT_CLEAN",[n]),!1
bg.paintWidgetInstance.setOrigSize(r.width,r.height),o.src!==n&&bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"scaleCanvas"),avpw$(bg.paintWidgetInstance.canvas).insertBefore("#avpw_temp_loading_image"),a.remove(),bg.tempLoadingImageSrc=n,bg.controlsWidgetInstance.showWaitThrobber(!1),bg.controlsWidgetInstance.loaderPhase=2,bg.launchData.actionListJSON&&bg.paintWidgetInstance.actions.importJSON(bg.launchData.actionListJSON,bg.fireLaunchComplete)}}).attr("src",e))},r=bg.controlsWidgetInstance.getScaledDims(avpw$(o).width(),avpw$(o).height())
if(bg.controlsWidgetInstance.loaderPhase=1,bg.paintWidgetInstance=new bg.PaintWidget(r.width,r.height,new bg.Actions,new bg.ModeManager,new bg.FilterManager,new bg.OverlayRegistry,new bg.ImageBorderManager),bg.controlsWidgetInstance.canvasUI=new bg.PaintUI(bg.paintWidgetInstance.canvas,bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"getEmbedElement")),bg.controlsWidgetInstance.initWithPaintWidget(bg.paintWidgetInstance),bg.paintWidgetInstance.setOrigSize(r.width,r.height),bg.controlsWidgetInstance.imageSizeTracker.setOrigSize(bg.launchData,o,r),a=avpw$("#avpw_temp_loading_image"),bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"scaleCanvas"),null!=n)if(!bg.launchData.enableCORS||!avpw$.support.cors||avpw$.browser.msie||avpw$.browser.safari&&-1===navigator.userAgent.indexOf("Chrome")&&parseInt(bg.util.getBrowserVersion())<7)if(-1===n.indexOf("data:")){if(!n||!n.match(/^http(s|):\/\//))return void bg.errorNotify("BAD_URL",[n])
bg.util.isURLSameDomain(n)?i(n):avpw$.ajax({type:"GET",dataType:"json",url:bg.build.jsonp_imgserver+"?callback=?",data:{url:escape(n)},success:function(e){i(e.data)},error:function(e,t,a){200===e.status&&"parsererror"===t?bg.controlsWidgetInstance&&(bg.controlsWidgetInstance.showWaitThrobber(!1),bg.util.nextFrame(function(){bg.paintWidgetCloser(!0),bg.errorNotify("BAD_URL",[n])})):bg.controlsWidgetInstance&&(bg.controlsWidgetInstance.showWaitThrobber(!1),bg.paintWidgetCloser(!0),bg.errorNotify("ERROR_SERVER_MESSAGING",[n]))}})}else i(n)
else i(n)
else{if(!bg.paintWidgetInstance.setBackground(o))return bg.paintWidgetCloser(!0),bg.launchData.enableCORS&&avpw$.support.cors?bg.errorNotify("ERROR_BAD_IMAGE_WITHOUT_CORS"):bg.errorNotify("IMAGE_NOT_CLEAN",[n]),!1
avpw$("#avpw_controls").insertAfter(bg.paintWidgetInstance.canvas),avpw$(bg.paintWidgetInstance.canvas).insertBefore(a),a.remove(),bg.tempLoadingImageSrc=o.src,bg.controlsWidgetInstance.showWaitThrobber(!1),bg.controlsWidgetInstance.loaderPhase=2,bg.launchData.actionListJSON&&bg.paintWidgetInstance.actions.importJSON(bg.launchData.actionListJSON,bg.fireLaunchComplete)}return cg.trigger("usage:submit","launch"),bg.launchData.actionListJSON||bg.fireLaunchComplete(),!1},bg.fireLaunchComplete=function(){var e=bg.launchData.initTool
bg.Events.trigger("layout:resize"),e&&(bg.util.nextFrame(function(){cg.trigger("tool:open",e)}),bg.paintWidgetInstance.moduleLoaded(e,function(e){bg.util.nextFrame(function(){avpw$("#avpw_holder").removeClass("avpw_init_hide")})})),"function"==typeof bg.launchData.onReady&&bg.launchData.onReady()},bg.paintWidgetShutdown=function(){if(cg.trigger("usage:submit","close"),bg.controlsWidgetInstance&&(bg.controlsWidgetInstance.serverMessaging&&(bg.controlsWidgetInstance.serverMessaging.shutdown(),bg.controlsWidgetInstance.serverMessaging=null),bg.controlsWidgetInstance.shutdown()),avpw$("#avpw_controls").hide(),bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"onShutdown"),"function"==typeof bg.launchData.onClose){var e=!1
bg.paintWidgetInstance&&bg.paintWidgetInstance.actions.hasMadeChanges()&&(e=!0),bg.launchData.onClose(e)}bg.paintWidgetInstance&&bg.paintWidgetInstance.shutdown(),bg.paintWidgetInstance=null,bg.controlsWidgetInstance=null,bg.tempLoadingImageSrc=null},bg.paintWidgetCloser=function(e){var t=bg.launchData.closeDelay
bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"onClose",[e]),e||0===t?(avpw$("#avpw_controls").hide(),bg.paintWidgetShutdown()):avpw$("#avpw_controls").fadeOut(t,function(){bg.paintWidgetInstance&&bg.paintWidgetShutdown()})},bg.controlsWidget_saveResponder=function(e,t,a){var n
"https:"===ag.location.protocol&&("string"==typeof t&&(t=t.replace("http:","https:")),"string"==typeof a&&(a=a.replace("http:","https:"))),"function"==typeof e&&(n=e.apply(bg.launchData,[bg.util.getImageId(bg.controlsWidgetInstance.paintImgIdElem),t,a])),bg.controlsWidgetInstance&&(bg.util.getImageElem(bg.controlsWidgetInstance.paintImgIdElem).avpw_prevURL=t,cg.trigger("tool:close"),n&&bg.controlsWidgetInstance.messager.show("avpw_aviary_beensaved",!0),bg.controlsWidgetInstance.paintWidget.dirty=!1,bg.controlsWidgetInstance.saving=!1)},bg.controlsWidget_onImageSaved=function(e,t){bg.controlsWidget_saveResponder(bg.launchData.onSave,e,t)},bg.controlsWidget_onHiResImageSaved=function(e){bg.controlsWidget_saveResponder(bg.launchData.onSaveHiRes,e)},bg.ControlsWidget=function(e,t,a,n,o){this.maxWidth=parseInt(bg.launchData.maxSize),this.maxHeight=this.maxWidth,this.saving=!1,this.origURL=null,this.activeTools=a,this.quitCount=0,bg.usageTracker.setup(),this.paintImgIdElem=t,cg.on("layout:resize",this.setupScrollPanels,this),this.layoutNotify(bg.launchData.openType,"showView",["main"]),e&&this.initWithPaintWidget(e)
var i={className:"avpw_tool_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70}
"mobile"!=bg.launchData.openType&&(i.color="#555",i.length=4),this.waitThrobber=new bg.Spinner({className:"avpw_canvas_spinner",lines:12,length:6,width:2,radius:6,color:"#fff",speed:.5,trail:70}),this.onEggWaitThrobber=new bg.Spinner(i),this.toolManager=new bg.ToolManager(this),this.assetManager=n,this.serverMessaging=o},bg.ControlsWidget.prototype.tool={},bg.ControlsWidget.prototype.layout={},bg.ControlsWidget.prototype.layoutNotify=function(e,t,a){return this.objectNotify("layout",e,t,a)},bg.ControlsWidget.prototype.objectNotify=function(e,t,a,n){var o
return"object"!=typeof this[e][t]||"function"!=typeof(o=this[e][t])[a]||(n||(n=[]),o[a].apply(o,n))},bg.ControlsWidget.prototype.shutdown=function(){this.canvasUI&&this.canvasUI.shutdown(),this.messager&&this.messager.hide(),cg.off("layout:resize",this.setupScrollPanels),this.shutdownAllTools(),this.unbindControls(),this.toolsPager&&(this.toolsPager.shutdown(),this.toolsPager=null),this.paintWidget&&(this.paintWidget.showWaitThrobber=null),bg.usageTracker.shutdown(),this.waitThrobber.stop(),this.onEggWaitThrobber.stop(),this.waitThrobber=null,this.onEggWaitThrobber=null,this.showPanel(null),this.toolManager.shutdown(),this.toolManager=null},bg.ControlsWidget.prototype.initAllTools=function(){var e,t
for(e in this.activeTools)t=this.activeTools[e],this.tool.hasOwnProperty(t)&&bg.paintWidgetInstance.moduleLoaded(t,function(e){cg.trigger("tool:init",e)}.AV_bindInst(this))
bg.launchData.forceCropPreset&&bg.paintWidgetInstance.moduleLoaded("forcecrop",function(e){cg.trigger("tool:init","forcecrop")}.AV_bindInst(this))},bg.ControlsWidget.prototype.shutdownAllTools=function(){var e,t
for(e in this.activeTools)t=this.activeTools[e],cg.trigger("tool:shutdown",t)
bg.launchData&&bg.launchData.forceCropPreset&&cg.trigger("tool:shutdown","forcecrop")},bg.ControlsWidget.prototype.bindControls=function(){},bg.ControlsWidget.prototype.unbindControls=function(){},bg.ControlsWidget.prototype.initWithPaintWidget=function(e){this.paintWidget=e,this.imageSizeTracker=new bg.ImageSizeTracker(e.actions),bg.featherUseFlash||this.initAllTools(),this.bindControls(),this.paintWidget.showWaitThrobber=this.showWaitThrobber.AV_bindInst(this)},bg.ControlsWidget.prototype.showWaitThrobber=function(e,t){var a,n=300,o=this
e?(a=this.layoutNotify(bg.launchData.openType,"getEmbedElement")).is(":visible")&&(this.waitThrobber.spin(a[0]),avpw$(this.waitThrobber).fadeIn(n)):avpw$(o.waitThrobber.el).fadeOut(n,o.waitThrobber.stop),t&&_f.setTimeout(t,5)},bg.publicName2PanelMode=function(e){return"stickers"===e&&(e="overlay"),"draw"===e&&(e="drawing"),"text"!==e||bg.featherUseFlash||(e="textwithfont"),e},bg.ControlsWidget.prototype.panelMode2WidgetMode=function(e){switch(e){case"rotate":return"rotate90"
case"greeneye":return"redeye"
case"pinch":return"bulge"}return e},bg.ControlsWidget.prototype.setupScrollPanels=function(){if(this.activeTools&&this.activeTools.length){var t,a,n=this,o=this.layoutNotify(bg.launchData.openType,"getDims").TOOLS_BROWSER_WIDTH,i=function(){n.toolsPager=new bg.Pager(e),n.toolsPager.changePage()},e={itemCount:this.activeTools.length,itemsPerPage:this.layoutNotify(bg.launchData.openType,"getToolsPerPage"),pageWidth:o,leftArrow:avpw$("#avpw_lftArrow"),rightArrow:avpw$("#avpw_rghtArrow"),itemBuilder:function(e){return t=n.activeTools[e],a=bg.util.getUserFriendlyToolName(t),a=bg.getLocalizedString(a),bg.template[bg.launchData.layout].eggIcon({optionName:t,capOptionName:a})},pageTemplate:bg.template[bg.launchData.layout].genericScrollPanel,pipTemplate:bg.template[bg.launchData.layout].scrollPanelPip,lastPageTemplate:void 0,lastPageContents:{},pageContainer:avpw$("#avpw_control_main_scrolling_region"),pipContainer:avpw$("#avpw_tools_pager ul"),onPageChange:function(e){bg.usageTracker.addPageHit(e)}}
i(),avpw$("#avpw_control_main_scrolling_region").css("width",n.toolsPager.getPageCount()*o+"px"),this.assetManager.getAssets("PERMISSION",function(e){var t,a=!0
if(e)for(t=0;t<e.length;t++)if("whitelabel"===e[t]){a=!1
break}a?(avpw$("#avpw_powered_branding").html(bg.template[bg.launchData.layout].poweredByFooterLogo).find("a").css("cursor","default"),n.toolsPager.shutdown(),i(),avpw$("#avpw_control_main_scrolling_region").css("width",n.toolsPager.getPageCount()*o+"px"),n.toolsPager.changePage()):avpw$("#avpw_controls").addClass("avpw_white_label")}),bg.usageTracker.setPageCount(n.toolsPager.getPageCount())}},bg.ControlsWidget.prototype.messager=(Hi={},Ji={show:function(e,t,a){Ei=Ei||avpw$("#avpw_messaging"),Fi=Fi||avpw$("#avpw_messaging_inner")
var n=Hi[e]||(Hi[e]=avpw$("#"+e))
Fi.append(n),Ei.fadeIn(150),t?(Ei.data("needsConfirmation",!0),bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"disableControls")):(Ei.data("needsConfirmation",!1),a||_f.setTimeout(this.hide,1e3))},hide:function(e,t){if(Ei=Ei||avpw$("#avpw_messaging"),Gi=Gi||avpw$("#avpw_messages"),e){var a=Hi[e]
a&&Gi.append(a)}else avpw$.each(Hi,function(e,t){Gi.append(t)})
Ei.data("needsConfirmation")?(_f.setTimeout(function(){t&&t()},400),bg.controlsWidgetInstance&&bg.controlsWidgetInstance.layoutNotify(bg.launchData.openType,"enableControls")):(Ei.hide(),t&&t())},addMessage:function(e){Gi=Gi||avpw$("#avpw_messages"),e&&(Gi[0].innerHTML+=e)}},cg.on("modal:show",Ji.show),cg.on("modal:hide",Ji.hide),Ji),bg.ControlsWidget.prototype.orientationChanged=function(e){},bg.ControlsWidget.prototype.windowResized=(Vi=null,function(e){_f.clearTimeout(Vi),Vi=_f.setTimeout(function(){cg.trigger("layout:resize"),Vi=null},500)}),bg.ControlsWidget.prototype.Slider=function(a){var n=!1,e=function(e,t){!n&&a.onstart&&a.onstart.apply(this,[e,t])},t=function(e,t){!n&&a.onchange&&a.onchange.apply(this,[e,t])},o=function(e,t){!n&&a.onslide&&a.onslide.apply(this,[e,t])},i=avpw$(a.element).slider({range:"min",max:a.max,min:a.min,value:a.defaultValue||a.max/2,delay:a.delay})
return this.getValue=function(){return i.slider("value")},this.setValue=function(e){return i.slider("value",e)},this.reset=function(e){n=!0,this.setValue(a.defaultValue),n=!1},this.addListeners=function(){i.bind("slidestart",e).bind("slidechange",t).bind("slide",o)},this.removeListeners=function(){i.unbind("slidestart").unbind("slide").unbind("slidechange")},this.shutdown=function(){i.slider("destroy")},this},bg.ControlsWidget.prototype._drawUICircle=function(e,t,a,n,o){this._drawUICircle_HTML(e,t,a,n,o)},bg.ControlsWidget.prototype._drawUICircle_HTML=function(e,t,a,n,o){var i,r=avpw$(e)[0],s=r.getContext("2d")
s.clearRect(0,0,r.width,r.height),o&&"transparent"!==n&&this._drawUIGrid(s,r.width,r.height),s.globalCompositeOperation="source-over",i=null!=a?(s.strokeStyle=o&&("transparent"==a||bg.util.color_is_white(a)||null==n)?"#444":a,3):(s.strokeStyle="rgba(0,0,0,0)",1),s.lineWidth=i,s.beginPath(),s.arc(r.width/2,r.height/2,t,0,2*Math.PI,!0),s.stroke(),s.closePath(),null!=n&&(s.save(),s.clip(),o&&"transparent"==n?this._drawUIGrid(s,r.width,r.height):(s.fillStyle=n,s.fillRect(0,0,r.width,r.height)),s.restore())},bg.ControlsWidget.prototype._drawUIGrid=function(e,t,a,n){var o,i
for(n||(n=5),i=0;i<a+n;i+=n)for(o=0;o<a+n;o+=n)e.fillStyle=1==(o+i&1)?"#fff":"#ddd",e.fillRect(o,i,n,n)},bg.ControlsWidget.prototype.showPanel=function(e){null!=e&&(avpw$(".avpw_controlpanel").each(function(){avpw$(this).hide()}),avpw$("#avpw_controlpanel_"+e).show())},bg.ControlsWidget.prototype.save=(Fj=!(Ej=null),Hj=function(){return{apikey:bg.launchData.apiKey,timestamp:bg.launchData.timestamp,signature:bg.launchData.signature,salt:bg.launchData.salt,encryptionMethod:bg.launchData.encryptionMethod}},Ij=function(e,t,a){var n=bg.controlsWidgetInstance
n.layoutNotify(bg.launchData.openType,"enableControls",[!0]),n.paintWidget.showWaitThrobber(!1),e?(avpw$(bg.util.getImageElem(n.paintImgIdElem)).avpw_prevURL=e,bg.controlsWidget_onImageSaved(e,t)):(bg.errorNotify("ERROR_SAVING",[bg.build.imgrecvServer,a]),bg.controlsWidgetInstance.saving=!1)},Jj=function(e,t){var a=bg.controlsWidgetInstance
a.layoutNotify(bg.launchData.openType,"enableControls",[!0]),a.paintWidget.showWaitThrobber(!1),e?(avpw$(bg.util.getImageElem(a.paintImgIdElem)).avpw_prevURL=e,bg.controlsWidget_onHiResImageSaved(e)):(t.Code&&t.JobStatus?bg.errorNotify("ERROR_SAVING_HI_RES",[t.Code,t.JobStatus]):bg.errorNotify("ERROR_SAVING",[bg.build.asyncImgrecvBase,t]),bg.controlsWidgetInstance.saving=!1)},Lj=function(r,s){var e,c,t,a,l=this,g=(bg.launchData.fileFormat||"").toLowerCase()
!g||g.length<1?(e=l.origURL,g=e?(a="image/png",-1!==(t=(t=e).toLowerCase()).indexOf("jpg",t.length-"jpg".length)?"image/jpg":-1!==t.indexOf("jpeg",t.length-"jpeg".length)?"image/jpeg":-1!==t.indexOf("gif",t.length-"gif".length)?"image/gif":-1!==t.indexOf("tiff",t.length-"tiff".length)?"image/tiff":-1!==t.indexOf("bmp",t.length-"bmp".length)?"image/bmp":-1!==t.indexOf("png",t.length-"png".length)?"image/png":a):"image/png"):g&&-1===g.indexOf("image/")&&(g="image/"+g),c=bg.S3Uploader.isCapable(g),l.paintWidget.exportImage(g,function(e){var t,a,n,o
function i(){bg.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:bg.build.imgrecvServer,method:"POST",announcer:bg.build.featherTargetAnnounce,origin:bg.build.imgrecvBase,keyValues:bg.util.extend(Hj(),{file:t,sessionid:bg.usageTracker.getUUID(),actionlist:l.paintWidget.actions.exportJSON(!0),origurl:o,hiresurl:bg.launchData.hiresUrl,contenttype:bg.launchData.fileFormat,jpgquality:bg.launchData.jpgQuality,debug:bg.launchData.debug,asyncsave:bg.launchData.asyncSave,usecustomfileexpiration:bg.launchData.useCustomFileExpiration,encodedas:"base64text"}),callback:function(){(s||function(e,t){var a,n,o,i,r,s,c,l=""
if("string"==typeof e)if(-1===e.indexOf("---FEATHER-POSTMESSAGE---"))try{n=e.split("<url>")[1].split("</url>")[0]}catch(e){bg.errorNotify("ERROR_SAVING",["Error parsing response."])}else n=(a=e.split("---FEATHER-POSTMESSAGE---"))[0],o=a[1]
else 0<(i=avpw$(e).find("error")).length?l=i.text():((r=avpw$(e).find("url"))&&(n=(n=r.text()).replace(/^\s+|\s+$/g,"")),(s=avpw$(e).find("hiresurl"))&&(o=(o=s.text()).replace(/^\s+|\s+$/g,"")))
c=[n,o,l],"function"==typeof t?t.apply(this,c):Ij.apply(this,c)}).apply(this,arguments)}})}a=e.indexOf(";",0),n=e.indexOf(",",a),e.slice(5,a),t=e.slice(n+1),e="",(o=l.origURL)&&0===o.indexOf("data:")&&(o=""),c?bg.S3Uploader.upload(g,t,function(e,t){e&&i(),r?Jj.call(this,t,null,e):Ij.call(this,t,null,e)}):i()})},Mj=function(e,t,a){var n=["didHitAzure:"+(e?"Yes":"No")," width:"+t," height:"+a," megaPixels:"+Math.round(t*a/1e6*10)/10].join("")
cg.trigger("usage:submit","saveHiRes",n)},Pj=function(e,t,a,n){var o,i=!bg.featherUseFlash
return i&&this.layoutNotify(bg.launchData.openType,"disableControls"),this.paintWidget.showWaitThrobber(i,function(){switch(e){case"saveHiRes":(function(){var e,t,a,n=bg.paintWidgetInstance.getScaledSize(),o=function(){if(Mj(!0,n.hiresWidth,n.hiresHeight),bg.launchData.hiresUrl){var e=bg.util.extend(Hj(),{actionlist:this.paintWidget.actions.exportJSON(!0),origurl:bg.launchData.hiresUrl,fileformat:bg.launchData.fileFormat,notificationmethod:"GET",backgroundcolor:"0xffffffff",jpgquality:bg.launchData.jpgQuality}),a=function(e){!e||e&&"JobFailed"===e.JobStatusCode?(Jj(null,e),_f.clearInterval(Ej)):e&&"JobCompleted"===e.JobStatusCode&&(_f.clearInterval(Ej),Jj(e.JobStatus)),Fj=!0}
bg.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:bg.build.asyncImgrecvCreateJob,method:"POST",dataType:"json",announcer:bg.build.asyncFeatherTargetAnnounce,origin:bg.build.asyncImgrecvBase,keyValues:e,callback:function(e){var t
e&&e.JobId?(t=e.JobId,Ej=_f.setInterval(function(){Fj&&bg.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_save_form",action:bg.build.asyncImgrecvGetJobStatus,method:"POST",dataType:"json",announcer:bg.build.asyncFeatherTargetAnnounce,origin:bg.build.asyncImgrecvBase,keyValues:bg.util.extend(Hj(),{jobid:t}),callback:a}),Fj=!1},1e3)):Jj(null,e)}})}else bg.errorNotify("ERROR_MISSING_HI_RES_URL")},i=this,r=function(){Lj.apply(i,[!0,function(e,t){Mj(!1,n.hiresWidth,n.hiresHeight),Jj.apply(this,arguments)}])},s=bg.util.isIE11()||-1!==navigator.userAgent.indexOf("MSIE")
s||bg.launchData.forceHiResSave||bg.launchData.hiresUrl!==bg.launchData.url?o.call(this):(n=bg.paintWidgetInstance.getScaledSize(),e=bg.launchData.maxSize,t=bg.launchData.hiresWidth,a=bg.launchData.hiresHeight,t&&a?e<t&&e<a?o.call(this):n.hiresWidth<e&&n.hiresHeight<e?r.call(this):o.call(this):o.call(this))}).call(o)
break
case"getImageData":(function(a,n,e){this.paintWidget.exportImage(e,function(e){var t=bg.controlsWidgetInstance
t.saving=!1,t.layoutNotify(bg.launchData.openType,"enableControls",[!0]),t.paintWidget.showWaitThrobber(!1),a&&"function"==typeof a&&(n?n=!1!==a(e):a(e)),n&&bg.util.nextFrame(function(){bg.controlsWidget_onImageSaved(t.origURL)})})}).call(o,t,a,n)
break
default:Lj.call(o)}}),o=this,!1},function(e,t,a,n){return!(bg.controlsWidgetInstance.loaderPhase<2)&&!this.saving&&(cg.trigger("tool:commit"),cg.trigger("tool:close"),this.saving=!0,bg.prevActionList=this.paintWidget.actions.exportJSON(!0),bg.launchData.postData&&"string"!=typeof bg.launchData.postData&&(bg.launchData.postData=bg.JSON.stringify(bg.launchData.postData)),Pj.apply(this,[e,t,a,n]))}),bg.ControlsWidget.prototype.onSaveButtonClicked=function(e){return cg.trigger("usage:submit","saveclicked"),("function"!=typeof bg.launchData.onSaveButtonClicked||!1!==bg.launchData.onSaveButtonClicked.apply(bg.launchData,[bg.util.getImageId(bg.controlsWidgetInstance.paintImgIdElem)]))&&bg.controlsWidgetInstance.save()},bg.ControlsWidget.prototype.showAreYouSure=function(){this.messager.show("avpw_aviary_quitareyousure",!0)},bg.ControlsWidget.prototype.cancel=function(e){var t
return this.quitCount++,t=0<this.quitCount&&this.paintWidget&&this.paintWidget.actions.hasMadeChanges(),"function"==typeof bg.launchData.onCloseButtonClicked?!1===bg.launchData.onCloseButtonClicked.apply(bg.launchData,[t])?bg.paintWidgetCloser():this.showAreYouSure():t?this.showAreYouSure():bg.paintWidgetCloser(),!1},bg.ControlsWidget.prototype.getScaledDims=function(e,t){return bg.util.getScaledDims(e,t,this.maxWidth,this.maxHeight)},bg.TransformStyle=function(e){var a=e||""
return this.set=function(n){var o,e,i,t
if(a)for(o in n)e=new RegExp(o+"\\([^\\)]*"),i=!1,t=function(e,t,a){return i=!0,o+"("+n[o]},a=a.replace(e,t),i||(a+=" "+o+"("+n[o]+")")
else for(o in n)a+=" "+o+"("+n[o]+")"},this.serialize=function(){return a},this},AV.errorNotify=function(e,t){var a={BAD_IMAGE:{code:1,message:"There was a problem loading your image provided to the `image` config key. Either it's not actually an image file or it doesn't really exist."},UNSUPPORTED:{code:2,message:"It looks like you're using a browser that doesn't support the HTML canvas element (and also doesn't have Flash installed either). Please try accessing this page through a modern browser like Chrome, Firefox, Safari, or Internet Explorer (version 9 or higher). Your internets will thank you."},BAD_URL:{code:3,message:"There was a problem loading the image URI provided to the ‘url’ config key. Please verify that the URI is publicly accessible, and that the image is a supported format."},UNSUPPORTED_TOOL:{code:4,message:"So sorry, but this tool is not available because it is not part of the set chosen with the `tools` config key. It's alternatively possible that your browser does not support this specific tool."},IMAGE_NOT_CLEAN:{code:5,message:"Uh oh! We can't edit this image because the editor wasn't set up correctly to load external files via their address. You must either provide images from the same domain as the web page with the editor OR pass the external image address via the `url` config key in order for Aviary to be able to get permission from the browser to open it for editing. Sorry for the inconvenience!"},UNSUPPORTED_FONT:{code:6,message:"So sorry, but this font looks to be unsupported by your browser or platform"},ERROR_SAVING:{code:7,message:"There was a problem saving your photo. Please try again."},NO_APIKEY:{code:8,message:"apiKey is required and not provided. See http://www.aviary.com/web-documentation#constructor-config-apikey."},ERROR_AUTHENTICATING:{code:9,message:"There was a problem retrieving access to content from our server. Please ensure all authentication keys are present or do not attempt premium partner authentication."},ERROR_BAD_THEME:{code:10,message:"Selected theme does not exist. Please use 'dark', 'light' or 'minimum' or see aviary.com/web for more info."},ERROR_BAD_IMAGE_WITHOUT_CORS:{code:11,message:"The image URL you are trying to use is either not on the same domain or is not configured for CORS. See http://enable-cors.org/ for more info."},ERROR_SERVER_MESSAGING:{code:12,message:"Error reaching Aviary services."},ERROR_BAD_AUTHENTICATION_PARAMETERS:{code:13,message:"Invalid authenticationURL response. Please check the formatting the response."},BAD_FORCECROP_TOOLS:{code:14,message:"If you're using the 'Force Crop' tool, the editor will disable the resize, orientation and crop tools so the user cannot change the intended forced size. It looks like the only tools you have enabled disabled by 'Force Crop'.."},ERROR_GET_ASSETS:{code:15,message:"Error getting assets. Please check your authentication parameters."},ERROR_MISSING_HI_RES_URL:{code:16,message:"Missing 'hiresUrl' from launch() method"},ERROR_WEBGL_LOST_CONTEXT:{code:17,message:"WebGL Error: the GL lost context."},ERROR_SAVING_HI_RES:{code:18,message:"There was a problem saving your photo."},UNSUPPORTED_FILE_FORMAT:{code:19,message:"`fileFormat` parameter only supports `png` or `jpg`."}}[e],n=a.message
return"function"==typeof AV.launchData.onError&&(a.args=t,n=AV.launchData.onError(a)||n),n},function(e,s,c){"use strict"
var l,o,t,a
e.AV=e.AV||{},l=e.AV,o=l.Events,(e.Aviary=l).feather_loaded=!1,l.feather_loading=!1,l.build=l.build||{version:"",imgrecvServer:"imgrecvserver",imgrecvBase:"",imgtrackServer:"imgtrackserver",jsonp_imgserver:"",featherTargetAnnounce:"feather_target_announce_v3.html",proxyServer:"",feather_baseURL:"",feather_stickerURL:"",googleTracker:""},l.defaultTools=["enhance","effects","frames","overlays","overlay","orientation","crop","resize","lighting","color","sharpness","focus","vignette","blemish","whiten","redeye","drawing","colorsplash","textwithfont","meme"],l.glSupportedTools=["enhance","effects","frames","overlays","overlay","orientation","crop","resize","lighting","color","sharpness","focus","vignette","blemish","whiten","redeye","drawing","colorsplash","textwithfont","meme"],t={image:null,apiKey:void 0,apiVersion:4,appendTo:null,language:"en",theme:null,minimumStyling:!(l.flashSupportedTools=["enhance","effects","overlay","crop","resize","orientation","brightness","contrast","saturation","sharpness","drawing","text","redeye","blemish"]),maxSize:1024,noCloseButton:!1,launchDelay:300,closeDelay:300,forceCropPreset:null,forceHiResSave:!1,authenticationURL:null,tools:void 0,initTool:"",cropPresets:["Custom","Original",["Square","1:1"],"3:2","3:5","4:3","4:5","4:6","5:7","8:10","16:9"],cropPresetDefault:"Custom",cropPresetsStrict:!1,url:null,enableCORS:!1,postUrl:void 0,postData:null,fileFormat:"",jpgQuality:100,displayImageSize:!1,hiresMaxSize:1e4,hiresWidth:null,hiresHeight:null,onLoad:void 0,onReady:void 0,onSaveButtonClicked:void 0,onSave:void 0,onSaveHiRes:void 0,onClose:void 0,onError:void 0,signature:null,timestamp:null,hiresUrl:void 0,isPremiumPartner:!0,useCustomFileExpiration:!1,allowInAppPurchase:!1,disableWebGL:!1,forceFlash:!1,forceSupport:!1,poweredByURL:"http://www.aviary.com",giveFeedbackURL:"http://support.aviary.com/",getWidgetURL:"https://creativesdk.adobe.com",debug:!1,asyncSave:!0},l.baseConfig=t,function(e){var t,a,n,o=function(e){return{language:e.Feather_Language,forceFlash:e.Feather_ForceFlash,forceSupport:e.AV_Feather_ForceSupport,onLoad:e.Feather_OnLoad,onReady:e.Feather_OnLaunchComplete,onClose:e.Feather_OnClose,onSave:e.Feather_OnSave,noCloseButton:e.Feather_NoCloseButton,maxSize:e.Feather_MaxSize||e.Feather_MaxDisplaySize,tools:e.Feather_EditOptions,cropPresets:e.Feather_CropSizes,resizePresets:e.Feather_ResizeSizes,apiKey:e.Feather_APIKey,hiresUrl:e.Feather_HiResURL,postUrl:e.Feather_PostURL,fileFormat:e.Feather_FileFormat||e.Feather_ContentType,jpgQuality:e.Feather_FileQuality,signature:e.Feather_Signature,timestamp:e.Feather_Timestamp}}
if(l.baseConfig=l.util.extend(l.baseConfig,o(e)),"https:"===e.location.protocol||"chrome-extension:"===e.location.protocol)for(n in l.build)l.build.hasOwnProperty(n)&&(2===(a=n.split("_SSL")).length&&l.build[n]&&(t=a[0],l.build[t]=l.build[n]))}(s),l.getLocalizedString=function(e){try{var t=l.languageStrings[e]
return void 0===t&&(t=e),t}catch(e){}return e},Function.prototype.AV_bindInst=function(e){var t=this
return function(){return t.apply(e,arguments)}},l.injectControls=function(){var e,t,a,n,o,i,r,s
t="popup"===l.launchData.openType?(e="",l.template[l.launchData.layout].saveBlock()):(e=l.template[l.launchData.layout].saveBlock(),""),l.criticalLayoutStyles&&!l.feather_loaded&&((a=c.createElement("style")).type="text/css",n=c.createTextNode(l.criticalLayoutStyles),a.styleSheet?a.styleSheet.cssText=n.nodeValue:a.appendChild(n),c.getElementsByTagName("head")[0].appendChild(a)),o=l.template[l.launchData.layout].controls({internalSaveBlock:e,externalSaveBlock:t}),(i=c.createElement("div")).id="avpw_holder",r="",l.featherUseFlash&&(r="avpw_flash "),l.msie&&(r+="avpw_ie"+l.msie),r&&(i.className=r),(s=c.getElementsByTagName("body"))&&(s=s[0]),s||(s=c.documentElement),s.appendChild(i),i.innerHTML=o},l.Feather=function(e){var r,t,a,i,n
return e||(e={}),r=this,e.authenticationURL&&(e.isPremiumPartner=!0,o.on("auth:update",function(e){t(e)})),t=function(i){s.avpw$.ajax({url:e.authenticationURL,cache:!1,type:"GET",contentType:"application/json"}).done(function(e){for(var t,a=["salt","timestamp","signature","encryptionMethod"],n=[],o=0;o<a.length;o++)e[t=a[o]]||n.push(t)
0<n.length&&l.errorNotify("ERROR_BAD_AUTHENTICATION_PARAMETERS",[n.join(", ")]),r.updateConfig({salt:e.salt,timestamp:e.timestamp,signature:e.signature,encryptionMethod:e.encryptionMethod}),i&&i()})},a=function(){l.injectControls(),l.util.nextFrame(l.loadStageFinal)},i=function(){"undefined"!=typeof avpw$?s.avpw$(c).ready(a):a()},e&&(e.openType="aviary",e.layout="desktop"),e=e||{},l.launchData=l.util.extend(l.baseConfig,e),function(){var e,t,a,n,o
if(l.featherUseFlash=!l.featherCanvasOk()&&l.featherFlashOk(),l.featherGLEnabled=l.launchData.forceGL||l.shouldUseWebGL(),l.featherUseFlash&&(l.launchData.forceHiResSave=!0),l.launchData.language=l.launchData.language.toLowerCase(),!l.feather_loaded&&!l.feather_loading){switch(l.feather_loading=!0,e=l.launchData.language||"en",t="js/feathercontrols_",t+=l.validLanguages&&l.validLanguages[e]?e+".js":"en.js",!l.launchData.theme&&l.launchData.minimumStyling&&(l.launchData.theme="minimum"),"minimum"===l.launchData.theme&&(l.launchData.minimumStyling=!0),l.launchData.theme||(l.launchData.theme="dark"),l.launchData.theme){case"dark":case"light":case"minimum":break
default:l.errorNotify("ERROR_BAD_THEME")}a=l.launchData.minimumStyling&&"minimum"===l.launchData.theme?"feather_core_":"feather_theme_aviary_",a+=l.launchData.theme,n=a,o=l.build.feather_baseURL+"css/"+n,l.util.loadFile(o+".css","css"),l.build.bundled?i():l.util.loadFile(l.build.feather_baseURL+t,"js",i)}}(),n=function(){return!l.paintWidgetInstance&&void l.paintWidgetLauncher(l.launchData.image,l.launchData.url)},r.launch=function(e){if(!l.feather_loaded)return!1
var t=c.getElementById("avpw_holder")
if(t||l.injectControls(),l.paintWidgetInstance){if(t)return!1
r.close(!0)}if(l.launchData&&(l.launchData.hiresWidth||l.launchData.hiresHeight)&&(l.launchData.hiresWidth=null,l.launchData.hiresHeight=null),e&&e.language&&delete e.language,l.launchData=e?l.util.extend(l.launchData,e):l.launchData,!l.launchData.image)return l.errorNotify("BAD_IMAGE"),!1
if(!l.launchData.apiKey)return l.errorNotify("NO_APIKEY"),!1
if("png"!==l.launchData.fileFormat&&"jpg"!==l.launchData.fileFormat&&""!==l.launchData.fileFormat&&(l.launchData.fileFormat=""),"object"==typeof e.forceCropPreset?(l.launchData.forceCropPreset=[e.forceCropPreset],l.launchData.initTool="forcecrop"):l.launchData.forceCropPreset=null,l.launchData.initTool&&(t.className+=" avpw_init_hide"),l.featherUseFlash)n()
else{if(!l.featherSupported())return l.errorNotify("UNSUPPORTED")&&(l.controlsWidgetInstance=new l.ControlsWidget,l.controlsWidgetInstance.layoutNotify(l.launchData.openType,"placeControls",[1<l.util.getApiVersion(l.launchData)?l.launchData.appendTo:void 0]),l.controlsWidgetInstance.bindControls(),c.getElementById("avpw_controls").style.display="block",l.controlsWidgetInstance.messager.show("avpw_aviary_unsupported",!0)),!0
l.util.nextFrame(n)}return!0},r.showWaitIndicator=function(){return!(!l.controlsWidgetInstance||!l.controlsWidgetInstance.showWaitThrobber)&&(l.controlsWidgetInstance.showWaitThrobber(!0),!0)},r.hideWaitIndicator=function(){return!(!l.controlsWidgetInstance||!l.controlsWidgetInstance.showWaitThrobber)&&(l.controlsWidgetInstance.showWaitThrobber(!1),!0)},r.getImageDimensions=function(){var e=null
return l.paintWidgetInstance&&(e=l.paintWidgetInstance.getScaledSize(),l.launchData.hiresWidth&&l.launchData.hiresHeight||(delete e.hiresWidth,delete e.hiresHeight)),e},r.save=function(){return!!l.paintWidgetInstance&&l.controlsWidgetInstance.save()},r.saveHiRes=function(){return!!l.paintWidgetInstance&&(l.launchData.authenticationURL?(o.trigger("auth:update",function(){l.controlsWidgetInstance.save("saveHiRes")}),!0):l.controlsWidgetInstance.save("saveHiRes"))},r.getImageData=function(e,t,a){return!!l.paintWidgetInstance&&l.controlsWidgetInstance.save("getImageData",e,t,a)},r.close=function(e){return!!l.paintWidgetInstance&&void l.paintWidgetCloser(e)},r.relaunch=function(){return o.trigger("usage:interact","api","relaunch"),l.isRelaunched=!0,!!l.launchData&&void r.launch(l.launchData)},r.activateTool=function(e){o.trigger("tool:open",e,l.controlsWidgetInstance)},r.replaceImage=function(e){return o.trigger("usage:interact","api","replaceImage"),!!l.launchData&&(r.close(!0),void l.util.nextFrame(function(){l.launchData.url=e,r.launch(l.launchData)}))},r.updateConfig=function(e,t){if(!l.launchData)return!1
if(e&&"object"==typeof e)for(var a in e)e.hasOwnProperty(a)&&(l.launchData[a]=e[a])
else{if(!e||"string"!=typeof e)return!1
l.launchData[e]=t}},r.getIsDirty=function(){return!!l.paintWidgetInstance&&l.paintWidgetInstance.actions.hasMadeChanges()},r.getActionList=function(){return l.paintWidgetInstance?(o.trigger("tool:commit"),l.paintWidgetInstance.actions.exportJSON(!0)):void 0},r.disableControls=function(){l.controlsWidgetInstance.layoutNotify(l.launchData.openType,"disableControls")},r.enableControls=function(){l.controlsWidgetInstance.layoutNotify(l.launchData.openType,"enableControls")},r.on=function(e,t){o&&e&&t&&"function"==typeof t&&o.on(e,t)},r.off=function(e,t){o&&e&&t&&"function"==typeof t&&o.off(e,t)},r},l.loadStageFinal=function(){l.feather_loaded=!0
var e=function(){"function"==typeof l.launchData.onLoad&&l.launchData.onLoad()}
l.launchData.authenticationURL?o.trigger("auth:update",e):e()},l.featherSupported=function(){return l.featherCanvasOk()||l.featherFlashOk()||l.launchData.forceSupport},l.featherFlashOk=function(){return!!l.launchData.forceFlash||s.avpw_swfobject&&s.avpw_swfobject.hasFlashPlayerVersion(l.build.MINIMUM_FLASH_PLAYER_VERSION)},l.featherCanvasOk=function(){if(l.launchData.forceFlash)return!1
var e=!!c.createElement("canvas").getContext,t="function"==typeof s.postMessage
return e&&t},l.shouldUseWebGL=function(){var e,t,a,n,o
return!l.launchData.disableWebGL&&(e=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),!(-1===navigator.userAgent.indexOf("Chrome")&&-1===navigator.userAgent.indexOf("Firefox")&&!e)&&(!(-1!==navigator.userAgent.indexOf("Firefox")&&(!(t=parseInt(navigator.userAgent.toLowerCase().split("firefox/")[1]))||t<33))&&(a=c.createElement("canvas"),void 0!==s.WebGLRenderingContext&&(!(!a||!a.getContext)&&(!!(n=a.getContext("webgl"))&&(o=n.getParameter(n.MAX_TEXTURE_SIZE),!(4*l.launchData.maxSize>o)))))))},l.getFlashMovie=function(e){return s[e]||c[e]},l.msie=function(){for(var e=3,t=c.createElement("div"),a=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",a[0];);return 4<e?e:void 0}(),l.firefox=("Gecko"===s.navigator.product&&(a=navigator.userAgent.split("Firefox/")[1],a=parseInt(a,10)),a)}(this,void 0!==window?window:{},void 0!==document?document:{}),AV.S3Uploader=(dn={},dn.isCapable=function(e){return!("image/png"!==e&&"image/jpg"!==e&&"image/jpeg"!==e||"function"!=typeof XMLHttpRequest||"function"!=typeof Blob||avpw$.browser.msie||AV.util.isIE11())},dn.upload=function(e,t,a){var n=function(e,t){e=atob(e)
for(var a=new ArrayBuffer(e.length),n=new Uint8Array(a),o=0;o<e.length;o++)n[o]=e.charCodeAt(o)
return new Blob([a],{type:t})}(t,e)
window.asi(AV.controlsWidgetInstance.paintImgIdElem,n,t,e),window.asic=function(e){a(null,e)}},dn),AV.support=function(e){var t,a,n,o,i,r=e.navigator.userAgent,s=e.screen.width,c=(e.screen.height,{0:/Android/i,1:/webOS/i,2:/iPhone/i,3:/iPod/i,4:/BlackBerry/i,5:/iPad/i}),l=0,g=0,u=0
for(a in c)r.match(c[a])&&(1,t=parseInt(a))
return r.match(/AppleWebKit/i)&&(l=1),0===t&&(g=1),1===g&&(n=r.match(/Android [0-9].[0-9]/).toString())&&(u=parseFloat(n.split("Android ")[1])),(o={isAppleWebkit:function(){return 1===l},isMobileWebkit:function(){return 1===l&&s&&(s<=480||0<u&&u<=2.3)},isIPhoneOrIPod:function(){return 2===t||3===t},isAndroid:function(){return 1===g},getAndroidVersion:function(){return u}}).getVendorProperty=(i={},function(e){return i[e]||(i[e]=function(e,t){var a,n,o=["webkit","ms","Moz","O"],i=e.style
if(void 0!==i[t])return t
for(t=t.charAt(0).toUpperCase()+t.slice(1),n=0;n<o.length;n++)if(void 0!==i[a=o[n]+t])return a}(document.createElement("div"),e))}),o}(window)}(window.AV||(window.AV={}),window,document)
