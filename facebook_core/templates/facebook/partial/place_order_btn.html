{% load template_helper %}
{% load perms_helper %}

{% if item.supplier %}
    {% if not item.supplier.is_dropified_print %}
    <div class="btn-group order-line-group"
        order-id="{{order.id}}"
        line-id="{{item.id}}"
        order-data-id="{{item.order_data_id}}"
        order-number="{{order.number}}"
        line-title="{{item.name}}"
        supplier-type="{{item.supplier_type}}"
        {% if item.shipping_method %}
            style="display:flex"
        {% endif %}
    >
        {% if item.shipping_method %}
        <a type="button" class="btn btn-success btn-xs itooltip place-order-btn queue-order-btn" data-container="body" data-html="true"
            title="Ship to <b>{{item.shipping_method.country_name}}</b> using <br><b>{{item.shipping_method.method_name}}</b>"
            data-href="{% app_link 'fb/orders/place' supplier=item.supplier.id SAPlaceOrder=item.order_data_id SACompany=item.shipping_method.method SACountry=item.shipping_method.country %}"
            href="#">
            {{item.shipping_method.method_short}}
        </a>
        <button type="button" class="btn btn-success btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="caret"></span>
        </button>

    {% else %}
        <button data-toggle="dropdown" class="btn {% if item.refunded %}btn-danger{% else %}btn-success{% endif %} btn-xs dropdown-toggle" aria-expanded="false">
            Place Order
            {% if item.refunded %}
                {% include 'partial/help_tooltip.html' with help="This Item was Refunded" qtipstyle="color:#fff" qtipicon="exclamation-triangle" %}
            {% endif %}
            <span class="caret"></span></button>
    {% endif %}

        <ul class="dropdown-menu pull-right">
            {% if item.order_track %}
            <li><a class="placed-order-details" href="#" order-id="{{order.id}}" source-order-id="{{item.order_track.source_id}}" source-url="{{item.order_track.get_source_url}}" order-date="{{item.order_track.created_at|date:'N j, Y, P'}}" line-id="{{item.id}}">Order Details</a></li>
            {% else %}
            <li><a class="mark-as-ordered" href="#" store="{{order.store.id}}" order-id="{{order.id}}" line-id="{{item.id}}" product-id="{{item.product.parent_product_id}}">Mark as Ordered</a></li>
            {% endif %}

            {% if not item.is_bundle and item.fulfillment_status == 'Unfulfilled' and order.status != 'PENDING' %}
            <li><a class="fulfill-btn" quantity="{{item.quantity}}" order-id="{{order.id}}" line-id="{{item.id}}" store="{{order.store.id}}" tracking-number="{{item.order_track.source_tracking}}">Mark as Fulfilled</a></li>
            {% endif %}

            {% if item.supplier.is_walmart %}
            <li><a href="{{item.supplier.product_url|create_walmart_affiliate_link:request.user}}" target="_blank">Manual Order</a></li>
            {% else %}
            <li><a href="{{item.supplier.short_product_url}}" target="_blank">Manual Order</a></li>
            {% endif %}

            {% if item.order_data_id and item.supplier.support_auto_fulfill %}
            <li class="divider"></li>
            <li><a class="place-order-btn queue-order-btn" href="#" order-id="{{order.id}}" line-id="{{item.id}}"
                    data-href="{% app_link 'fb/orders/place' supplier=item.supplier.id SAPlaceOrder=item.order_data_id SAStep=True %}"
                   >Step By Step Order</a></li>
               <li><a class="place-order-btn queue-order-btn add-to-cart" href="#" order-id="{{order.id}}" line-id="{{item.id}}" style="display:none"
                    data-href="{% app_link 'fb/orders/place' supplier=item.supplier.id SAPlaceOrder=item.order_data_id SACart=True SACompany=item.shipping_method.method SACountry=item.shipping_method.country %}"
                   >Add To Cart</a></li>
            <li><a class="place-order-btn queue-order-btn" href="#" order-id="{{order.id}}" line-id="{{item.id}}"
                    data-href="{% app_link 'fb/orders/place' supplier=item.supplier.id SAPlaceOrder=item.order_data_id %}"
                   >Auto Place Order</a></li>
            <li><a class="place-order-btn auto-shipping-btn" href="#"
                    order-id="{{order.id}}" line-id="{{item.id}}"
                    product-id="{{item.product.parent_product_id}}" original-id="{{item.supplier.get_source_id}}" country-code="{{order.shipping.country}}"
                    data-href="{% app_link 'fb/orders/place' supplier=item.supplier.id %}"
                    data-order="{{ item.order_data_id|urlencode }}"
                >Auto - Choose Shipping</a></li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
{% else %}
    <span class="label label-warning">Not Tracked</span>
{% endif %}
